<!DOCTYPE html>

<!--Low voltage disconnect customer form
    Programmed by Henry Holben and Weston Street using some code generated by ChatGPT, https://chat.openai.com/


-->

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arduino Code Generator</title>

		<form>

        
        <!--Device Name-->
            <h3>Device Name</h3>
            <label for="DeviceName">Device Name:</label>
            <br>
            <input type="text" id="DeviceName" name="DeviceName" value="Theophilus">
            <br>
            <input type="checkbox" id="EnableNameChange" name="EnableNameChange" value="true">Allow the user to change the name of their low voltage disconnect
            <br>
        
        <!--Nominal Voltage-->
            <h3>Nominal voltage</h3>
            <label for="NominalVoltage">Enter NominalVoltage Value:</label>
            <input type="number" id="NominalVoltage" name="NominalVoltage" value="12" required> volts
            <br>
            <span class="error" id="NominalVoltageError" style="color:red"></span><br><br>
            <br>
            <input type="checkbox" id="EnableNominalVoltageInterface" name="EnableNominalVoltageInterface" value="true" checked="checked">Allow the user to change the nominal voltage <br>
            <br>
        
        <!--Shut off Voltage Form-->
            <h3>Shut Off voltage</h3>
            <label for="ShutOffVoltage">Enter ShutOffVoltage Value:</label> volts
            <input type="number" id="ShutOffVoltage" name="ShutOffVoltage" value="6" required> volts
            <span class="error" id="ShutOffVoltageError"></span><br><br><br>
            <input type="checkbox" id="EnableShutOffVoltageInterface" name="EnableShutOffVoltageInterface" value="ShutOffEnabled">Allow the user to change the turn-back-on voltage <br>
<br>
        <!-- Shut Off Voltage Timer-->
            <h3>Shut Off Voltage Timer:</h3>
            <p>This is a buffer period meant to prevent the LVDC from disconnecting prematurely on account of current spikes, troughs, or noise.</p>
            <input type="number" id="ShutOffVoltageTimer" name="ShutOffVoltageTimer" value="30"> seconds
            <br>
            <input type="checkbox" id="EnableShutOffVoltageTimerBoolean" name="EnableShutOffVoltageTimerBoolean" value="TRUE">
            <label for="EnableTimerOffsetBoolean">Check to enable changing of shut off voltage timer</label><br>
        
        
        <!--Turn Back on Voltage Form-->
            <h3>Turn-back on Voltage:</h3>
            <input type="number" id="TurnBackOnVoltage" name="TurnBackOnVoltage" value="10"> volts
            <br>
            <input type="checkbox" id="EnableTurnBackOnVoltageInterface" name="EnableTurnBackOnVoltageInterface" value="TurnBackOnEnabled">
            <label for="TurnBackOnVoltage">Allow the user to change the turn-back-on voltage</label><br>
        

        <!-- Override-->
            <h3>Overide:</h3>
            <input type="number" id="OverrideDelay" name="OverrideDelay" value="20"> minutes
            <br>
            <input type="checkbox" id="override" name="override" value="TRUE">
            <label for="override">Check to change overide delay time</label><br>
            <br>
            <br>
        
        <!-- TimerOffset-->
            <h3>Timer Offset:</h3>
            <input type="number" id="TimerOffset" name="TimerOffset" value="0"> seconds
            <br>
            <input type="checkbox" id="EnableTimerOffsetBoolean" name="EnableTimerOffsetBoolean" value="TRUE">
            <label for="EnableTimerOffsetBoolean">Check to enable changing of the timer offset</label><br>
        
        <!-- Language-->
            <h3>Language:</h3>
            Default Language:
            <br>
            <input type="radio" id="english" name="LanguageSetting" value="english" checked="checked">
            <label for="english">English</label> 
            <input type="radio" id="spanish" name="LanguageSetting" value="spanish">
            <label for="spanish">Spanish</label><br>
            <br>
            <br>
            <input type="checkbox" id="EnableLanguageInterface" name="EnableLanguageInterface" value="LanguageChoiceEnabled">
            <label for="EnableLanguageInterface">Check to enable language selection</label><br>
            <br>
        
        <!-- Board-->
            <h3>Board:</h3>
            Select a device:
            <br>
            <input type="radio" id="ArduinoNano" name="DeviceSetting" value="ArduinoNano" checked="checked">
            <label for="ArduinoNano">Arduino Nano</label> 
            <br>
            <input type="radio" id="ArduinoNanoESP32" name="DeviceSetting" value="ArduinoNanoESP32">
            <label for="ArduinoNanoEsp32">Arduino Nano ESP 32</label>
            <br>
            <input type="radio" id="ArduinoUno" name="DeviceSetting" value="ArduinoUno">
            <label for="ArduinoUno">Arduino Uno</label> 
            <br>
            <input type="radio" id="ArduinoMega" name="DeviceSetting" value="ArduinoMega">
            <label for="ArduinoMega">Arduino Mega</label><br>

        <!-- Controller type-->
            <h3>Controller type:</h3>
            Select a controller type:
            <br>
            <input type="radio" id="ButtonArray" name="ControlTypeSetting" value="ButtonArray" checked="checked">
            <label for="ButtonArray">Array of 5  push buttons</label> 
            <br>
            <input type="radio" id="Encoder" name="ControlTypeSetting" value="Encoder">
            <label for="Encoder">RotaryEncoder</label><br>
            <br>

        <!--Buttons to begin the generation of the arduino file:-->
            <button type="button" onclick="generateCode()">Generate Arduino Code</button>
            <br>            

        
    </form>
    
    <br>
    
    <a id="downloadLink" style="display: none" download="arduino_code.ino">Download Arduino Code</a>
    
    <script>
        
        
        //Explanations

        // explanations are given as arrays: ["English version", "Spanish version"];
            ExplanationNominalVoltage = ["This is the expected voltage of the battery when fully charged",""];
            ExplanationShutOffVoltage = ["This is the battery voltage at which the device will disconnect the load and the inverter from battery power.",""];
            ExplanationTurnBackOnVoltage = ["This is the battery voltage at which the device will reconnect the iinverter and the load if previously disconnected",""];
            ExplanationCurrentRange = ["",""];
            ExplanationOverride = ["This is the period of time the device will provide power to the inverter and the load, even with a battery voltage that is less than the set shut-off voltage if the end-user manually opts to reconnect after the load and the inverter have been disconnected by the device",""];
            ExplanationLanguage = ["This is the language that the end-user interface will appear in on the device.",""];
            ExplanationBoard = ["This is the microncontroller your low voltage disconnect is to be based upon.",""];
        
        //Generate the arduino Code
        function generateCode() 
        {

            //Extract Variables From the Form
                //Nominal Battery Voltage JS Variable
                    const DeviceName = document.getElementById("DeviceName").value;
            
                //Nominal Battery Voltage JS Variable
                    const NominalVoltage = document.getElementById("NominalVoltage").value;

                  
                //Shut off Voltage JS Variable
                    const ShutOffVoltage = document.getElementById("ShutOffVoltage").value;
            
                //Shut off Voltage Timer JS Variable
                    const ShutOffVoltageTimer = document.getElementById("ShutOffVoltageTimer").value;    
            
            
                //Turn back on voltage JS Variables
                    const TurnBackOnVoltage = document.getElementById("TurnBackOnVoltage").value; //Turn Back on Voltage JS Variable
           
                //Override JS Variables
                    const OverrideDelay = document.getElementById("OverrideDelay").value; //Override Delay JS Variable
           
                //Timer Offset
                    const TimerOffset = document.getElementById("TimerOffset").value; //Turn Back on Voltage JS Variable

                //Language JS Variables
                    if(document.getElementById("english").checked==true)
                    {
                        var LanguageSetting = 0;
                    }// end if
            
                    if(document.getElementById("spanish").checked == true)
                    {
                        var LanguageSetting = 1;
                    }// end if
                           
                //Device JS Variables
                    if(document.getElementById("ArduinoNano").checked==true)
                    {
                        var DeviceSelection = 1;
                    }// end if
            
                    if(document.getElementById("ArduinoNanoESP32").checked == true)
                    {
                        var DeviceSelection = 2;
                    }// end if
                    
                    if(document.getElementById("ArduinoUno").checked==true)
                    {
                        var DeviceSelection = 3;
                    }// end if
            
                    if(document.getElementById("ArduinoMega").checked == true)
                    {
                        var DeviceSelection = 4;
                    }// end if
            
                //Control Type JS Variables
                    if(document.getElementById("ButtonArray").checked == true)
                    {
                        var ControlSelection = 1;
                    }// end if
            
                    if(document.getElementById("Encoder").checked == true)
                    {
                        var ControlSelection = 2;
                    }// end if
                    
            
            
            //User-adjustables: in this section, we will create an array to represent all items the customer has decided to allow the end user to change using the end-user interface. We wil then create a string full of arduino code related to creating the end-user interface's menu which we can later inject into the final arduino program
            
            
            const MaximumRowNumber = 4;//this is because we are using an LCD screen with 4 rows. If that changes, you will want to change this constant right here.
            
          var Adjustables = [];
            if(document.getElementById("EnableNameChange").checked == true)
            {
                 Adjustables.push(["Device Name", "Nombre Dispositivo"]);
            }// end if
            
            if(document.getElementById("EnableNominalVoltageInterface").checked == true)
            {
                 Adjustables.push(["Batt. Voltage", "V. Bateria"]);
            }// end if
            
            if(document.getElementById("EnableShutOffVoltageInterface").checked == true)
            {
                 Adjustables.push(["CutOff Voltage", "Corte Voltaje"]);
            }// end if
            
            if(document.getElementById("EnableTurnBackOnVoltageInterface").checked == true)
            {
                 Adjustables.push(["CutOn Voltage", "Encendido Voltaje"]);
            }// end if
            
            if(document.getElementById("override").checked == true)
            {
                 Adjustables.push(["Override Time", "Anulación Tiempo"]);
            }// end if
            
            if(document.getElementById("EnableTimerOffsetBoolean").checked == true)
            {
                 Adjustables.push(["Timer Offset", "Despl. Temporizador"]);
            }// end if
            
            if(document.getElementById("EnableLanguageInterface").checked == true)
            {
                 Adjustables.push(["Language/Lengua", "Language/Lengua"]);
            }//end if

            const NumberOfOptions = Adjustables.length; //we are about to change Adjustables.length, so we need to save this value for later

            if(Adjustables.length < MaximumRowNumber)
            {
                for(i=Adjustables.length; i<MaximumRowNumber; i++)
                {
                    Adjustables.push(["                   ", "                   "]);
                }

            }


                // Convert the array of adjustable menu items to a string representation
                var MenuItems = "//Menu Items: \n \t String InterfaceItems[][2] = {";
                for (var i = 0; i < Adjustables.length; i++) 
                {
      
                        MenuItems += "{\"" + Adjustables[i][0];
                        MenuItems += "\", \"";
                        MenuItems += Adjustables[i][1];
                        MenuItems += "\"}";
                  

                    if (i < Adjustables.length - 1) 
                    {
                        MenuItems += ", ";
                    }//end if
                }//end for
                MenuItems += "}; \n \n";

            
            
                   
            
             

                     //Check that inputs are valid       
                                const NominalVoltageError = document.getElementById('NominalVoltageError');
                                const ShutOffVoltageError = document.getElementById('ShutOffVoltageError');

            
                                NominalVoltageError.textContent = '';
                                ShutOffVoltageError.textContent = '';

                                if (!NominalVoltage) 
                                {

                                    alert("Please enter a positive integer multiple of 12 for Nominal Voltage.");
                                }
            
                                else if (NominalVoltage % 12 !== 0) 
                                {
                                    NominalVoltageError.textContent = 'Please enter a positive integer multiple of 12 for Nominal Voltage.';
                                    alert("Nominal Voltage must be a positive integer multiple of 12.");
                                }

                                else if (isNaN(ShutOffVoltage) || ShutOffVoltage <= 0) 
                                {
                                     alert("Please enter a positive number for Shut Off VOltage (decimal values allowed");
                                }
                                
                                else if (isNaN(TurnBackOnVoltage) || TurnBackOnVoltage <= 0) 
                                {
                                     alert("Please enter a positive number for Turn Back On Voltage(decimal values allowed");
                                }
                                else if (isNaN(OverrideDelay) || TurnBackOnVoltage <= 0) 
                                {
                                     alert("Please enter a positive number for override delay (decimal values allowed");
                                }
                                else
                                {
            
             //Set up pin assignments
                const PinData = 
                      [
                            {
                                "Name": "ArduinoNano",
                                "VoltageProbe": "19", //"Pin A0"
                                "lcdSDA": "23",//"Pin A4"
                                "lcdSCL": "24",//"Pin A5"
                                "EncoderCLK": "9",//"Pin D6"
                                "EncoderDT": "10",//"Pin D7"
                                "EncoderSW": "11",//"Pin D8"
                                "OverrideDelayButton": "12",//"Pin D9"
                                "RelayOutput": "13",//"Pin10"
                                "InputUp": "2",//Pin 2
                                "InputDown": "3",//Pin 3   
                                "InputRight": "4",//Pin 4
                                "InputLeft": "5",//Pin 5     
                                "InputSelect": "6"//Pin 6
                            },   
                            {
                                "Name": "ArduinoNanoESP32",
                                "VoltageProbe": "19", //"Pin A0"
                                "lcdSDA": "23",//"Pin A4"
                                "lcdSCL": "24",//"Pin A5"
                                "EncoderCLK": "9",//"Pin D6"
                                "EncoderDT": "10",//"Pin D7"
                                "EncoderSW": "11",//"Pin D8"
                                "OverrideDelayButton": "12",//"Pin D9"
                                "RelayOutput": "13",//"Pin10"
                                "InputUp": "2",//Pin 2
                                "InputDown": "3",//Pin 3   
                                "InputRight": "4",//Pin 4
                                "InputLeft": "5",//Pin 5     
                                "InputSelect": "6"//Pin 6
                            }, 
                            {
                                "Name": "ArduinoUno",
                                "VoltageProbe": "A0", //"Pin A0"
                                "lcdSDA": "27",//"Pin A4"
                                "lcdSCL": "19",//"Pin A5 blue 22 AWG"
                                "EncoderCLK": "3",//"Pin 11"
                                "EncoderDT": "2",//"Pin D10"
                                "EncoderSW": "6",//"Pin D9
                                "OverrideDelayButton": "13",//"Pin D13" This is for the manual Override delay button
                                "RelayOutput": "3",//"Pin D3"
                                "InputUp": "11",//Pin D11
                                "InputDown": "7",//Pin D7   
                                "InputRight": "8",//Pin D8
                                "InputLeft": "10",//Pin 10     
                                "InputSelect": "9"//Pin D9

                            },
                            {
                                "Name": "ArduinoMega",
                                "VoltageProbe": "A0", //"Pin A0"
                                "lcdSDA": "27",//"Pin A4"
                                "lcdSCL": "19",//"Pin A5"
                                "EncoderCLK": "6",//"Pin D6"
                                "EncoderDT": "7",//"Pin D7"
                                "EncoderSW": "8",//"Pin D8"
                                "OverrideDelayButton": "10",//"Pin D10"
                                "RelayOutput": "2",//"Pin D2 (digital pin 2)"
                                "InputUp": "6",//Pin D2
                                "InputDown": "7",//Pin D3   
                                "InputRight": "8",//Pin D4
                                "InputLeft": "5",//Pin D5     
                                "InputSelect": "10"//Pin D6
                             }
                        ];

            // Generate Arduino code based on user input
            
                /*Start*/
                    const CodeHead =
                      `//Milligan Engineering Low Voltage Disconnect Arduino Code`
                      +
                      `\n`
                      +
                      `\n \t`
                      ;
            
                /*Libraries*/     
                    const LibrariesSectionEncoder =
                      `//Specify Libraries for a device with an encoder`
                      +
                      `\n \t`
                      +
                      `#include <EEPROM.h> //This library is necesary for memory management`
                      +
                      `\n \t`
                      +
                      `#include <LiquidCrystal_I2C.h> //This library is necesary for LCD display management`
                      +
                      `\n \t`
                      +
                      `#include <Encoder.h> //This library is necesary for using rotary encoders as inputs`
                      +
                      `\n \t`
                      +
                      `LiquidCrystal_I2C lcd(0x27,20,4);  // set the LCD address to 0x27 for a 20 chars and 4 line display`
                      +
                      `\n \t`
                      +
                      `const int EEPROM_ADDR = 0; // EEPROM address to store the user input`
                      +
                      `\n \t`
                      +
                      `const int MAX_INPUT_LENGTH = 32; // Maximum length of user input`
                      +
                      `\n \t`
                      +
                      `char userInput[MAX_INPUT_LENGTH] = {0}; // Buffer to store user input`
                      +
                      `\n \n`
                      ;
                                    
                /*Libraries for device with button array*/     
                      `//Specify Libraries for a device with an array of 5 buttons for control input`
                      +
                      `\n \t`
                      +
                      `#include <EEPROM.h> //This library is necesary for memory management`
                      +
                      `\n \t`
                      +
                      `#include <LiquidCrystal_I2C.h> //This library is necesary for LCD display management`
                      +
                      `\n \t`
                      +
                      `\n \t`
                      +
                      `LiquidCrystal_I2C lcd(0x27,20,4);  // set the LCD address to 0x27 for a 20 chars and 4 line display`
                      +
                      `\n \t`
                      +
                      `const int EEPROM_ADDR = 0; // EEPROM address to store the user input`
                      +
                      `\n \t`
                      +
                      `const int MAX_INPUT_LENGTH = 32; // Maximum length of user input`
                      +
                      `\n \t`
                      +
                      `char userInput[MAX_INPUT_LENGTH] = {0}; // Buffer to store user input`
                    const LibrariesSectionButtonArray =
                      +
                      `\n`
                      ;
            
                /*LCD Related*/
                      const LiquidCrystalDisplayVariablesSection =
                      `//Liquid crystal display related variables`
                      +
                      `\n \n`
                      +
                      `int scrollPosition = 0;     //First Line`
                      +
                      `\n \t`
                      +
                      `bool selectPressed = false; // Select button latch`
                      +
                      `\n \t`
                      +
                      `int ReturnToStatusPage = false;`
                      +
                      `\n`
                      ;       
                const VoltageProbeSpecifications =
/*Voltage Probe Related*/`//Voltage Probe related variables`
                      +
                      `\n \t`
                      +
                      `const float Resistor1 = 1.35e6; //ohms`
                      +
                      `\n \t`
                      +
                      `const float Resistor2 = 750e3; //ohms`
                      +
                      `\n \n`
                      ;
/*Customer-set Variables*/const GlobalVariables =
                      `//Global Variables:`
                      +
                      `\n \t`
                      +
                      `String DeviceName = "${DeviceName}";`
                      +
                      `\n \t`
                      +
                      `float NominalVoltage = ${NominalVoltage};`
                      +
                      `\n \t`
                      +
                      `float ShutOffVoltage = ${ShutOffVoltage};`
                      +
                      `\n \t`
                      +
                      `float TurnBackOnVoltage = ${TurnBackOnVoltage};`
                      +
                      `\n \t`
                      +
                      `unsigned long OverrideDelay = ${OverrideDelay}*60000; //milliseconds`
                      +                      
                      `\n \t`
                      +
                      `unsigned long TimerOffset = ${TimerOffset}*1000; //milliseconds`
                      +
                      `\n \t`
                      +
                      `const int DisconnectBufferTime = ${ShutOffVoltageTimer};  // Number of seconds to add to Disconnect timer (minimum value)`
                      +
                      `\n \t`
                      +
                      `int LanguageSetting = ${LanguageSetting};`
                      +
                      `\n \t`
                      +
                      `int DeviceSetting = ${DeviceSelection};`
                      +
                      `\n \t`
                      +
                      `int SelectedPage = 0;`
                      +
                      `\n \t`
                      +
                      `bool OutputState = 1;`                      
                      +
                      `\n \t`
                      +
                      `const int MaximumEncoderPosition = 4;`
                      +
                      `\n`
                      ;
            
/*Timer Related*/ const TimerRelatedVariables =
                      `//Timer-related variables`
                      +
                      `\n \t`
                      +
                      `unsigned long previousMillis = 0;`
                      +
                      `\n \t`
                      +
                      `unsigned long RolloverTime = (pow(2,32)-1);// Set an interval in milliseconds to ensure that millis() rollover (happens once approximately every 50 days when millis() resets to zero) is never an issue for more than 10 minutes`
                      +
                      `\n \n`
                      +
                      `\n \n`
                      ;
/*Pin Assignments*/const GetPinAssignments =
                      `//Get Pin Assignments:`
                      +
                      `\n \t`
                      +
                     `int VoltageProbe= ${PinData[DeviceSelection-1].VoltageProbe};`
                      +
                      `\n \t`
                      +
                      `int lcdSDA= ${PinData[DeviceSelection-1].lcdSDA};`
                      +
                      `\n \t`
                      +
                      `int lcdSCL= ${PinData[DeviceSelection-1].lcdSCL};`
                      +
                      `\n \t`
                      +
                      `int EncoderCLK = ${PinData[DeviceSelection-1].EncoderCLK};`
                      +
                      `\n \t`
                      +
                      `int EncoderDT = ${PinData[DeviceSelection-1].EncoderDT};`
                      +
                      `\n \t`
                      +
                      `int EncoderSW = ${PinData[DeviceSelection-1].EncoderSW};`
                      +
                      `\n \t`
                      +
                      `int OverrideDelayButton = ${PinData[DeviceSelection-1].OverrideDelayButton};`
                      +
                      `\n \t`
                      +
                      `int RelayOutput = ${PinData[DeviceSelection-1].RelayOutput};`
                      +
                      `\n \t`
                      +
                      `int InputUp = ${PinData[DeviceSelection-1].InputUp};`
                      +
                      `\n \t`
                      +
                      `int InputDown = ${PinData[DeviceSelection-1].InputDown};`
                      +
                      `\n \t`
                      +
                      `int InputRight = ${PinData[DeviceSelection-1].InputRight};`
                      +
                      `\n \t`
                      +
                      `int InputLeft = ${PinData[DeviceSelection-1].InputLeft};`
                      +
                      `\n \t`
                      +             
                      `int InputSelect = ${PinData[DeviceSelection-1].InputSelect};`
                      +
                      `\n `
                      ;                                

/*Screen Case Statements*/const EncoderSetup =
                       `//Encoder`
                       +
                       `\n \t`
                       +
                       `Encoder myEncoder(2, 3); // Connect encoder pins (Clk,DT)`
                       +
                       `\n \t`
                       +
                       `long oldPosition  = -999;`
                       +
                       `\n \t`
                       +
                       `int EncoderDirection = 0;                 //Idle by default`
                       +
                       `\n \t`
                       +
                       `const int scrollThreshold = 10;    //Update this value based on the desired sensitivty of your encoder`
                       +
                       `\n \t`
                       +
                       `int ChangeInPosition = 0;`
                       +
                       `\n \t`
                       +
                       `int EncoderSelectState = HIGH;`
                       +
                       `\n \t`
                       +
                       `static int lastEncoderSelectState = HIGH;`
                       +
                       `\n`
                       ;





/*Status Pages*/       var StatusPage = `\n`
                       +
                       `//Status Page`
                       +
                       `\n \t`
                       +
                       `void StatusPageScreen()`
                       +
                       `\n \t`
                       +
                       `{`
                       +
                       `\n \t \t`
                       +
                       `String PageHeader[2] = {"       Status:      ", "       Estado:      "};`
                       +
                       `\n \t \t`
                       +
                       `String ConnectionStatus[][2] = {{"Load Disonnected    ", "Carga Desconectada  "}, {"Load Connected      ", "Carga Conectada     "}};`
                       +
                       `\n \t \t`
                       +
                       `String BatteryVoltageStatus[2] = {"Measurement(v):", "Medición(v):"};`
                       +
                       `\n \t \t`
                       +
                       `String OverrideStatus[][2] = {{"Override: On             ", "Anulación Activada  "}, {"Override: Off       ", "Anulación Desact.   "}};`
                       +
                       `\n \t \t`
                       +
                       `lcd.setCursor(0,0);`
                       +
                       `\n \t \t`
                       +
                       `lcd.print(PageHeader[LanguageSetting]);`//print the menu title "Status:"
                       +
                       `\n \t \t`
                       +
                       `lcd.setCursor(0,1);`
                       +
                       `\n \t \t`
                       +
                       `lcd.print(ConnectionStatus[OutputState][LanguageSetting]);`//print the connection status for on or off
                       +
                       `\n \t \t`
                       +
                       `lcd.setCursor(0,2);`
                       +
                       `\n \t \t`
                       +
                       `lcd.print(BatteryVoltageStatus[LanguageSetting]);`//print the measured boltage. The comma after MeasureVoltage indicates to print to only 2 decimal places on the LCD display
                       +
                       `\n \t \t`
                       +
                       `lcd.setCursor(16,2);`
                       +
                       `\n \t \t`
                       +
                       `lcd.print(MeasureVoltage());`
                       +
                       `\n \t \t`
                       +
                       `lcd.setCursor(0,3);`
                       +
                       `\n \t \t`
                       +
                       `lcd.print(OverrideStatus[OutputState][LanguageSetting]);`//print the menu title "Status:"
                       +
                       `\n \t \t`
                       +
                       `} // end of StatusPageScreen()`
                       +
                       `;`
                       ;
/*Adjust Nominal Voltage Page*/var AdjustNominalVoltagePage = `\n \t`
                         +
                         `void AdjustNominalVoltage() =`
                         +
                         `\n \t`
                         +
                         `{`
                         +
                         `String NominalVoltagePageItems[][2] = {{"Battery Voltage     ", "Voltaje Batería     "},{" volts        ", " voltios     "},{"Cancel ", "Cancelar  "},{"Confirm", "  Confirmar"}};`
 	 	                 +
                         `lcd.setCursor(0,0);`
 	 	                 +
                         `lcd.print(NominalVoltagePageItems[0][LanguageSetting]+":");`
 	 	                 +
                         `lcd.setCursor(0,1);`
 	 	                 +
                         `lcd.print(NominalVoltage + NominalVoltagePageItems[1][LanguageSetting]);`
 	 	                 +
                         `lcd.setCursor(0,2);`
 	 	                 +
                         `lcd.print("                    ");`
 	 	                 +
                         `lcd.setCursor(0,3);`
 	 	                 +
                         `lcd.print("                    ");`
 	 	                 +
                         `} //end Adjust Nominal Voltage`
                         +
                         `\n \n`
                         ;


                         


/*Menu Page*/    
            var MenuPage = `\n`
                       +
                       `//LCD Screen Menu Page Case Statements: `
                       +
                       `\n \t`
                       +
                       `void MenuPageScreens(int scrollPosition)`
                       +
                       `\n \t`
                       +
                       `{`
                       +
                       `\n \t \t`
                       +
                       `switch(scrollPosition)`
                       +
                       `\n \t \t \t`
                       +
                       `{`
                       +
                       `\n \t \t \t`
                       ;
                      
             for (var i = 0; i < Adjustables.length; i++) 
             {
                if(i<MaximumRowNumber)
                {
                               
                         var MenuPage = MenuPage+
                        `case ` + i +`:`
                         +
                         `\n \t \t \t`
                         ;
                     for (var j = 0; j < MaximumRowNumber; j++) 
                     {


                         var MenuPage = MenuPage+
                         `lcd.setCursor(0,`+j+`);`
                         +
                         `\n \t \t \t`
                         ;

                         if (j==i)
                         {
                             var MenuPage = MenuPage+
                            `lcd.print(">"+`
                             ;
                         }//end if j=i
                         else
                         {
                             var MenuPage = MenuPage+
                            `lcd.print(" "+`
                             ;                     
                         }//end else

                         var MenuPage = MenuPage+
                         `InterfaceItems[`+j+`][LanguageSetting]);`
                         +
                         `\n \t \t \t`
                         ;

                     }//end for j = 0
                         var MenuPage = MenuPage
                         +
                         `break;`
                         +
                         `\n \n \t \t \t`
                         ;
                 }//end if i<4
                 else
                 {
                      var MenuPage = MenuPage
                      +
                      `case ` + i +`:`
                      +
                      `\n \t \t \t`
                      ;
                        
                         for (var j = i-MaximumRowNumber+1; j <= i; j++) 
                         {


                             var MenuPage = MenuPage+
                             `lcd.setCursor(0,`+j+`);`
                             +
                             `\n \t \t \t`
                             ;

                             if (j==i)
                             {
                                 var MenuPage = MenuPage+
                                 `NextPage = InterfaceItems[j][LanguageSetting]);`
                                 +
                                 `\n \t \t \t`
                                 +
                                 `lcd.print(">"+`
                                 ;
                             }//end if j=3
                             else
                             {
                                 var MenuPage = MenuPage+
                                `lcd.print(" "+`
                                 ;                     
                             }//end else

                             var MenuPage = MenuPage+
                             `InterfaceItems[`+j+`][LanguageSetting]);`
                             +
                             `\n \t \t \t`
                             ;

                         }//end for j = 0
                         var MenuPage = MenuPage
                         +
                         `break;`
                         +
                         `\n \n \t \t \t`
                         ;
                      
                 }//end else
            
             }//end for i = 0
            
                         var MenuPage = MenuPage
                         +
                         `\n \t \t`
                         +
                         `}// end switch(scrollPosition)`
                         +
                         `\n \t`
                         +
                         `}// end MenuPageScreens`
                         +
                         `\n \n`
                         ;
      
/*Nominal Voltage End-user interface menu*/    
            var NominalVoltagePage = `\n`
                         +
                         `//Adjust Nominal Voltage: `
                         +
                         `\n \t`
                         +
                         `\n \t`
                         +
                         `void AdjustNominalVoltage()`
                         +
                         `\n \t`
                         +
                         `{`
                         +
                         `\n \t \t \t`
                         +
                         `String NominalVoltagePageItems[][2] = {{"Battery Voltage     ", "Voltaje Batería     "},{" volts        ", " voltios     "},{"Cancel ", "Cancelar  "},{"Confirm", "  Confirmar"}};`
                         +
                         `\n \t \t`
                         +
                         `lcd.setCursor(0,0);`
                         +
                         `\n \t \t`
                         +
                         `lcd.print(NominalVoltagePageItems[0][LanguageSetting]+":");`//print the menu title "Battery Voltage"
                         +
                         `\n \t \t`
                         +
                         `lcd.setCursor(0,1);`
                         +
                         `\n \t \t`
                         +
                         `lcd.print(NominalVoltage + NominalVoltagePageItems[1][LanguageSetting]);`//print the current nominal voltage setting
                         +
                         `\n \t \t`
                         +
                         `lcd.setCursor(0,2);`
                         +
                         `\n \t \t`
                         +
                         `lcd.print("                    ");`
                         +
                         `\n \t \t`
                         +
                         `lcd.setCursor(0,3);`
                         +
                         `\n \t \t`
                         +
                         `lcd.print("                    ");`
                         +
                         `\n \t \t`
                         +
                         `} //end Adjust Nominal Voltage`
                         +
                         `\n \t`
                         +
                         `void AdjustCutOffVoltagePage()`
                         +
                         `\n \t`
                         +
                         `{`
 	                     +
                         `\n`
                         +
                         `String ShutOffVoltagePageItems[][2] = {{"Cut-Off Voltage     ", "Voltaje corte       "},{" volts          ", " voltios            "},{"Cancel ", "Cancelar  "},{" Confirm", "  Confirmar"}};`
 	                     +
                         `\n `
                         +
                         `lcd.setCursor(0,0);`
                         +
                         `\n \t`
                         +
                         `lcd.print(ShutOffVoltagePageItems[0][LanguageSetting]+":");`
 	                     +
                         `\n`
                        +
                        `lcd.setCursor(0,1);`
 	                    +
                        `lcd.print(ShutOffVoltage+ShutOffVoltagePageItems[1][LanguageSetting]);`
 	                    +
                        `\n \t `
                        +
                        `lcd.setCursor(0,2);`
 	                    +
                        `\n \t `
                        +                       
                        `lcd.print("                    ");`
                        +
                        `\n \t `
                        +
                        `lcd.setCursor(0,3);`
 	                    +
                        `\n \t `
                        +
                        `lcd.print("                    ");`
 	                    +
                        `\n \t `
                        +
                        `}`
                        +
                        `\n \t`
                        +
                        `void AdjustReconnectVoltagePage()`
                        +
                         `\n \t`
                        +
                        `{`
 	                    +
                        `\n \t `
                        +
                        `String ReconnectVoltagePageItems[][2] = {{"Reconnect Voltage   ", "Voltaje Reconexion  "},{" volts        ", " voltios    "}};`
 	                    +
                        `\n \t `
                        +
                        `lcd.setCursor(0,0);`
 	                    +
                        `\n \t `
                        +
                        `lcd.print(ReconnectVoltagePageItems[0][LanguageSetting]+":");`
 	                    +
                        `\n \t `
                        +
                        `lcd.setCursor(0,1);`
 	                    +
                        `\n \t `
                        +
                        `lcd.print(TurnBackOnVoltage + ReconnectVoltagePageItems[1][LanguageSetting]);`
 	                    +
                        `\n \t `
                        +
                        `lcd.setCursor(0,2);`
 	                    +
                        `\n \t `
                        +
                        `lcd.print("                    ");`
 	                    +
                        `\n \t `
                        +
                        `lcd.setCursor(9,2);`
 	                    +
                        `\n \t `
                        +
                        `lcd.print("                    ");`
 	                    +
                        `\n \t `
                        +
                        `}`
                        +
                        `\n \t`
                        +
                        `void AdjustOverrideTimePage()`
                        +             
                        `\n \t`
                        +
                        `{` 
 	                    +
                        `\n \t `
                        +
                        `String OverrideTimePageItems[][2] = {{"Override Time       ", "Tiempo Anulación    "},{" minutes           ", "     minutos          "}};`
 	                    +
                        `\n \t `
                        +
                        `lcd.setCursor(0,0);`
 	                    +
                        `\n \t `
                        +
                        `lcd.print(OverrideTimePageItems[0][LanguageSetting]+":");`
 	                    +
                        `\n \t `
                        +
                        `lcd.setCursor(0,1);`
 	                    +
                        `\n \t `
                        +
                        `lcd.print(OverrideDelay/60000+ OverrideTimePageItems[1][LanguageSetting]); //the divide by 60000 converts to minutes` 
 	                    +
                        `\n \t `
                        +
                        `lcd.setCursor(0,2);`
 	                    +
                        `\n \t `
                        +
                        `lcd.print("                    ");`
 	                    +
                        `\n \t `
                        +
                        `lcd.setCursor(0,3);`
 	                    +
                        `\n \t `
                        +
                        `lcd.print("                    ");`
 	                    +
                        `\n \t `
                        +
                        `}`
                         +
                         `\n \n`
                         ;
      
      
                                     
                                    
                                    
                                    
                                    
      
      
    /*Void Scroll*/   const ButtonScrollFunction =
                      `\t`
                      +
                      `void Scroll()`
                      +
                      `\n \t`
                      +
                      `{`
                      +
                      `\n \t \t`
                      +
                      `int UP_State = digitalRead(InputUp);`
                       +
                       `\n \t \t`
                       +
                       `int Down_State = digitalRead(InputDown);`
                       +
                       `\n \t \t`
                       +
                       `if (UP_State == HIGH && scrollPosition>0)`
                       +
                       `\n \t \t`
                       +
                       `{`
                       +
                       `\n \t \t \t`
                       +
                       `scrollPosition--;`
                       +
                       `\n \t \t`
                       +
                       `} //End of ButtonScroll()`
                       +
                       `\n \t \t`
                       +
                       `if (Down_State == HIGH && scrollPosition<3)`
                       +
                       `\n \t \t`
                       +
                       `{`
                       +
                       `\n \t \t \t`
                       +
                       `scrollPosition++;`
                       +
                       `\n \t \t`
                       +
                       `} // end of if(Down_State == HIGH && scrollPosition<3) `
                       +
                       `\n \t \t`
                       +
                       `//Might need to add to where it doesn't change multiple lines on holding buttons.`
                       +
                       `\n \t \t`
                       +
                       `MenuPageScreens(scrollPosition);`
                       +
                       `\n \t`
                       +
                       `} // end void Scroll()`
                       + 
                       `\n \t`
                       ;
                                    
/*Void EncoderScroll*/ const EncoderScrollFunction =
                       `// Scroll function for a devicew with a rotary encoder control input:`
                       +
                       `\n \t`
                       +
                       `void Scroll()`
                       +
                       `\n \t`
                       +
                       `{`
                       +
                       `\n \t \t`
                       + 
                       `scrollPosition = 3-abs((myEncoder.read()/4)%4);`
                       +
                       '\n \t \t'
                       +
                       `if (scrollPosition > MaximumEncoderPosition)`
                       +
                       `\n \t \t`
                       +
                       `{`
                       +
                       `\n \t \t \t`
                       +
                       `scrollPosition = scrollPosition-MaximumEncoderPosition-1;`
                       +
                       `\n \t \t`
                       +
                       `}`
                       +
                       `\n \t`
                       + 
                       `} //end Scroll() function`
                       +
                       `\n \t`
                       ;            
                                    
                                    
/*Void Select*/const ButtonSelectFunction =
                   `void Select()`
                   +
                   `\n \t`
                   +
                   `{`
                   +
                   `\n \t \t`
                   +
                   `int RIGHT_State = digitalRead(InputRight);`
                   +
                   `\n \t \t`
                   +
                   `int LEFT_State = digitalRead(InputLeft);`
                   +
                   `\n \t \t`
                   +
                   `\n \t \t`
                   +
                   `if (scrollPosition == 1)`
                   +
                   `\n \t \t`
                   +
                   `{`
                   +
                   `\n \t \t \t`
                   +
                   `MenuPageScreens(scrollPosition);    // Keep updating the screen`
                   +
                   `\n \t \t \t`
                   +
                   `if ((RIGHT_State == HIGH)&&(EnableShutOffVoltageBoolean == true))`
                   +
                   `\n \t \t \t`
                   +
                   `{`
                   +
                   `\n \t \t \t \t`
                   +
                   `ShutOffVoltage = ShutOffVoltage + 0.1;`
                   +
                   `\n \t \t \t`
                   +
                   `} //end if((RIGHT_State == HIGH)&&(EnableShutOffVoltageBoolean == true))`
                   +
                   `\n \t \t \t`
                   +
                   `if ((LEFT_State == HIGH)&&(EnableShutOffVoltageBoolean == true))`
                   +
                   `\n \t \t \t`
                   +
                   `{`
                   +
                   `\n \t \t \t \t`
                   +
                   `ShutOffVoltage = ShutOffVoltage - 0.1;`
                   +
                   `\n \t \t \t`
                   +
                   `} // end if((LEFT_State == HIGH)&&(EnableShutOffVoltageBoolean == true))`
                   +
                   `\n \t \t`
                   +
                   `} //end (if ScrollPosition==1)`
                   +  
                   `\n \t \t`
                   +
                   `else if (scrollPosition == 2)`
                   +  
                   `\n \t \t`
                   +
                   `{`
                   +
                   `\n \t \t \t`
                   +
                   `MenuPageScreens(scrollPosition);`
                   +
                   `\n \t \t \t`
                   +
                   `if ((RIGHT_State == HIGH)&&(EnableTurnBackOnVoltageInterface == true))`
                   +
                   `\n \t \t \t`
                   +
                   `{`
                   +
                   `\n \t \t \t \t`
                   +
                   `TurnBackOnVoltage = TurnBackOnVoltage + 0.1;`
                   +
                   `\n \t \t \t`
                   +
                   `} //if ((RIGHT_State == HIGH)&&(EnableTurnBackOnVoltageInterface == true))`
                   +
                   `\n \t \t \t`
                   +
                   `if ((LEFT_State == HIGH)&&(EnableTurnBackOnVoltageInterface == true))`
                   +  
                   `\n \t \t \t`
                   +
                   `{`
                   +
                   `\n \t \t \t \t`
                   +
                   `TurnBackOnVoltage = TurnBackOnVoltage - 0.1;`
                   +
                   `\n \t \t \t`
                   +
                   `} //end of  if((LEFT_State == HIGH)&&(EnableTurnBackOnVoltageInterface == true))`
                   +
                   `\n \t \t`
                   +
                   `} //end of else if (scrollPosition == 2)`
                   +
                   `\n \t \t`
                   +
                   `else if (scrollPosition == 3)`
                   +
                   `\n \t \t`
                   +
                   `{`
                   +
                   `\n \t \t \t`
                   +
                   `MenuPageScreens(scrollPosition);`
                   +
                   `\n \t \t \t`
                   +
                   `if ((RIGHT_State == HIGH)&&(EnableOverrideChange == true))`
                   +
                   `\n \t \t \t`
                   +
                   `{`
                   +
                   `\n \t \t \t \t`
                   +
                   `OverrideDelay = OverrideDelay + (5*60000);`
                   +
                   `\n \t \t \t`
                   +
                   `} //end if ((RIGHT_State == HIGH)&&(EnableOverrideChange == true))`
                   +
                   `\n \t \t \t`
                   +
                   `if ((LEFT_State == HIGH)&&(EnableOverrideChange == true))`
                   +
                   `\n \t \t \t`
                   +
                   `{`
                   +
                   `\n \t \t \t \t`
                   +
                   `OverrideDelay = OverrideDelay - (5*60000);`
                   +
                   `\n \t \t \t`
                   +
                   `} //end of if ((LEFT_State == HIGH)&&(EnableOverrideChange == true))`
                   +
                   `\n \t \t`
                   +
                   `}   //end of else if (scrollPosition == 3)`
                   +
                   `\n \t`
                   +
                   `} //end void Select()` 
                   +
                   `\n \t`
                   ;
                                    
/*Void Encoder Select*/const EncoderSelectFunction =
                   `void Select(int SelectedPage)`
                   +
                   `\n \t`
                   +
                   `{`
                   +
                   `\n \t`
                   +
                   `long newPosition = myEncoder.read();`
                   +
                   `\n \t`
                   +
                   `if (newPosition != oldPosition)`
                   +
                   `{`
                   +
                   `\n \t`
                   +
                   `//ChangeInPosition = ChangeInPosition % scrollThreshold;  //Not needed if ChangeInPosition reset`
                   +
                   `\n \t`
                   +
                   `ChangeInPosition++;`
                   +
                   `\n \t`
                   +
                   `if (newPosition > oldPosition)`
                   +
                   `\n \t`
                   +
                   `{`
                   +
                   `\n \t`
                   +
                   `EncoderDirection = 1;`
                   +
                   `\n \t`
                   +
                   `}`
                   +
                   `\n \t`
                   +
                   `else if (newPosition < oldPosition)`
                   +
                   `{`
                   +
                   `\n \t`
                   +
                   `EncoderDirection = 2;`
                   +
                   `\n \t`
                   +
                   `}`
                   +
                   `\n \t`
                   +
                   `else`
                   +
                   `\n \t`
                   +
                   `{`
                   +
                   `\n \t`
                   +
                   `EncoderDirection = 0;  //Idle`
                   +
                   `\n \t`
                   +
                   `}`
                   +
                   `\n \t`
                   +
                   `if (SelectedPage == 0)`
                   +
                   `\n \t`
                   +
                   `{`
                   +
                   `\n \t`
                   +
                   `AdjustNominalVoltage();    // Keep updating the screen`
                   +
                   `\n \t`
                   +
                   `if (EncoderDirection == 2 && abs(ChangeInPosition >= scrollThreshold))`
                   +
                   `\n \t`
                   +
                   `{`
                   +
                   `\n \t`
                   +
                   `if (NominalVoltage < 48.0)`
                   +
                   `\n \t`
                   +
                   `{`
                   +
                   `\n \t`
                   +
                   `NominalVoltage = NominalVoltage + 12;`
                   +
                   `\n \t`
                   +
                   `}`
                   +
                   `\n \t`
                   +
                   `} //end if(RIGHT_State == HIGH)`
                   +
                   `\n \t`
                   +
                   `if (EncoderDirection == 1 && abs(ChangeInPosition >= scrollThreshold))`
                   +
                   `\n \t`
                   +
                   `{`
                   +
                   `\n \t`
                   +
                   `if (NominalVoltage > 12)`
                   +
                   `{`
                   +
                   `\n \t`
                   +
                   `NominalVoltage = NominalVoltage - 12;`
                   +
                   `\n \t`
                   +
                   `}`
                   +
                   `\n \t`
                   +
                   `}`
                   +
                   `\n \t`
                   +
                   `}`
                   +
                   `\n \t`
                   +
                   `else if (SelectedPage == 1)`
                   +
                   `\n \t`
                   +
                   `{`
                   +
                   `\n \t`
                   +
                   `AdjustCutOffVoltagePage();`
                   +
                   `\n \t`
                   +
                   `if (EncoderDirection == 2 && abs(ChangeInPosition >= scrollThreshold)) //clockwise`
                   +
                   `\n \t`
                   +
                   `{`
                   +
                   `\n \t`
                   +
                   `ShutOffVoltage = ShutOffVoltage + 0.1;`
                   +
                   `\n \t`
                   +
                   `} //end if(RIGHT_State == HIGH)`
                   +
                   `\n \t`
                   +
                   `if (EncoderDirection == 1 && abs(ChangeInPosition >= scrollThreshold))`
                   +
                   `\n \t`
                   +
                   `{`
                   +
                   `\n \t`
                   +
                   `ShutOffVoltage = ShutOffVoltage - 0.1;`
                   +
                   `\n \t`
                   +
                   `} // end if(LEFT_State == HIGH)`
                   +
                   `\n \t`
                   +
                   `} //end (if SelectedPage==1)`
                   +
                   `\n \t`
                   +
                   `else if (SelectedPage == 2)`
                   +
                   `\n \t`
                   +
                   `{`
                   +
                   `\n \t`
                   +
                   `AdjustReconnectVoltagePage();`
                   +
                   `\n \t`
                   +
                   `if (EncoderDirection == 2 && abs(ChangeInPosition >= scrollThreshold))`
                   +
                   `\n \t`
                   +
                   `{`
                   +
                   `\n \t`
                   +
                   `TurnBackOnVoltage = TurnBackOnVoltage + 0.1;`
                   +
                   `\n \t`
                   +
                   `} //if (RIGHT_State == HIGH)`
                   +
                   `\n \t`
                   +
                   `if (EncoderDirection == 1 && abs(ChangeInPosition >= scrollThreshold))`
                   +
                   `\n \t`
                   +
                   `{`
                   +
                   `\n \t`
                   +
                   `TurnBackOnVoltage = TurnBackOnVoltage - 0.1;`
                   +
                   `\n \t`
                   +
                   `} //end of  if(LEFT_State == HIGH)`
                   +
                   `\n \t`
                   +
                   `} //end of else if (SelectedPage == 2)`
                   +
                   `\n \t`
                   +
                   `else if (SelectedPage == 3)`
                   +
                   `\n \t`
                   +
                   `{`
                   +
                   `\n \t`
                   +
                   `AdjustOverrideTimePage();`
                   +
                   `\n \t`
                   +
                   `if (EncoderDirection == 2 && abs(ChangeInPosition >= scrollThreshold))`
                   +
                   `\n \t`
                   +
                   `{`
                   +
                   `\n \t`
                   +
                   `OverrideDelay = OverrideDelay + (5*60000);`
                   +
                   `\n \t`
                   +
                   `}`
                   +
                   `\n \t`
                   +
                   `if (EncoderDirection == 1 && abs(ChangeInPosition >= scrollThreshold) && (OverrideDelay > 0))`
                   +
                   `\n \t`
                   +
                   `{`
                   +
                   `\n \t`
                   +
                   `OverrideDelay = OverrideDelay - (5*60000);`
                   +
                   `\n \t`
                   +
                   `} //end of if (LEFT_State == HIGH)`
                   +
                   `\n \t`
                   +
                   `}`
                   +
                   `\n \t`
                   +
                   `oldPosition = newPosition;    //Update oldPosition for next iteration`
                   +
                   `\n \t`
                   +
                   `}`
                   +
                   `\n \t`
                   +
                   `}`
                   ;
                                    
/*Void Read User Input*/const ReadUserInputMemoryFunction =
                   `void readUserInput()`
                   +
                   `\n`
                   +
                   `{`
                   +
                   `\n \t`
                   +
                   `// Read user input from EEPROM and load it into the userInput buffer`
                   +
                   `\n \t`
                   +
                   `for (int i = 0; i < MAX_INPUT_LENGTH; i++)`
                   +
                   `{`
                   +
                   `\n \t \t`
                   +
                   `char c = EEPROM.read(EEPROM_ADDR + i);`
                   +
                   `\n \t \t`
                   +
                   `if (c ==`
                   +
                   String.raw`'\0'`
                   +
                   `)`
                   +
                   `\n \t \t`
                   +
                  `{`
                  +
                  `\n \t \t \t`
                  +
                  `break; // End of stored data`
                  +
                  `\n \t \t`
                  +
                  `} //End of if statement`
                  +
                  `\n \t \t`
                  +
                  `userInput[i] = c;`
                  +
                  `\n \t`
                  +
                  `}//end of for loop`
                  +
                  `\n`
                  +
                  `} //end of Read User Input`
                  +
                  `\n \n`
                  ;
/*Void Write User Input*/const WriteUserInputMemoryFunction =
                  `void writeUserInput()`
                  +
                  `\n`
                  +
                  `{`
                  +
                  `\n \t`
                  +
                  `// Write user input from the userInput buffer to EEPROM`
                  +
                  `\n \t`
                  +
                  `for (int i = 0; i < MAX_INPUT_LENGTH; i++)`
                  +
                  `\n \t`
                  +
                  `{`
                  +
                  `\n \t \t`
                  +
                  `if (userInput[i] == `
                  +
                  String.raw`'\0'`
                  +
                  `)`
                  +
                  `\n \t \t`
                  +
                  `{`
                  +
                  `\n \t \t \t`
                  +
                  `break; // End of input`
                  +
                  `\n \t \t`
                  +
                  `} //end of if statment`
                  +
                  `\n \t`
                  +
                  `EEPROM.write(EEPROM_ADDR + i, userInput[i]);`
                  +
                  `\n \t`
                  +
                  `} //end of for loop`
                  +
                  `\n \t`
                  +
                  `EEPROM.write(EEPROM_ADDR + MAX_INPUT_LENGTH, `
                  +
                  String.raw`'\0'`
                  +
                  `); // Null-terminate the string`
                  +
                  `\n`
                  +
                  `} //end of writeUserInput`
                  +
                  `\n`
                  +
                  `\n \n`
                  ;
/*TimeSinceBoot*/const TimeSinceBootFunction =
                  `//Find the time since the Low Voltage Disconnect was turned on`
                  +
                  `\n \t`
                  +
                  `unsigned long TimeSinceBoot()`
                  +
                  `\n \t`
                  +
                  `{`
                  +
                  `\n \t`
                  +
                  `unsigned long SystemTime = millis()+TimerOffset; // TimerOffset allows manipulating timers for testing purposes (you can start the timer at a much later time than the actual time since starting)`
                  +
                  /*
                  `\n \t`
                  +
                  `Serial.print(DeviceName +"System Time: ");`
                  +
                  `\n \t`
                  +
                  `Serial.print(SystemTime/1000);`
                  +
                  `\n \t`
                  +
                  `Serial.print(DeviceName +" seconds");`
                  +
                  `\n \t`
                  +
                  `Serial.print(`
                  +
                  String.raw`'\n'`
                  +
                  `);`
                  +
                  */
                  `\n \t`
                  +
                  `return(SystemTime);`
                  +
                  `\n \t`
                  +
                  `} //end of TimeSinceBoot() function`
                  ;
/*Start Timer Function*/const StartTimerFunction =
                  `//SetTimerEnd`
                  +
                  `\n`
                  +
                  `unsigned long SetTimerEnd()`
                  +
                  `\n \t`
                  +
                   `{`
                  +
                  `\n \t \t`
                  +
                  `unsigned long ShutOffTime;`
                  +
                  `\n \t \t`
                  +
                   `if(TimeSinceBoot()>=RolloverTime-OverrideDelay)`
                  +
                  `\n \t \t`
                  +
                  `{`
                  +
                  `\n \t \t \t`
                  +
                  `ShutOffTime = (TimeSinceBoot()+OverrideDelay)-RolloverTime;`
                  +
                  `\n \t \t \t`
                  +  
                  `\n \t \t \t`
                  +
                  `\n \t \t`
                  +
                   `} //end of if statement`
                  +
                  `\n \t \t`                  
                  +
                  `else // "normal operation", when TimeSinceBoot() is not within the Override Delay's duration of the millis() rollover`
                  +
                  `\n \t \t`
                  +
                  `{`
                  +
                  `\n \t \t \t`
                  +
                  `ShutOffTime = TimeSinceBoot()+OverrideDelay;`
                  +                  
                  `\n \t \t`
                  +
                  `} //end of else statement`
                  +
                  `\n \t`
                  +
                  `return(ShutOffTime);`
                  +
                  `\n`
                  +
                   `} //end of SetTimerEnd() function`
                  +
                  `\n \n`
                  ;
/*Voltage Measurement*/const VoltageMeasurementFunction =
                  `float MeasureVoltage()`
                  +
                  `\n`
                  +
                  `{`
                  +
                  `\n \t`
                  +
                  `float VoltageMeasurement= analogRead(VoltageProbe)*5/1023; //The ratio is 5 Volts (max voltage that can go into a pin)/ 1023 (AnalogRead() measures between 0 and 1023`
                  +
                  `\n \t`
                  +
                  `float BatteryVoltage = VoltageMeasurement*(Resistor1+Resistor2)/(Resistor2); //This uses voltage divider math to caclulate the battery voltage.`
                  +
                  `\n \t`
                  +
                  /*
                  `Serial.print(DeviceName +"Voltage measured at probe = ");`
                  +
                  `\n \t`
                  +
                   `Serial.print(VoltageMeasurement);`
                  +
                  `\n \t`
                  +
                  `\n \t`
                  +
                  `Serial.print(`
                  +
                  String.raw`'\n'`
                  +
                  `);`
                  +
                  `\n \t`
                  +
                  
                  `Serial.print(DeviceName +"Battery Voltage = ");` 
                  +
                  `\n \t`
                  +
                  `Serial.print(BatteryVoltage);`
                  +
                  `\n \t`
                  +
                  `Serial.print(`
                  +
                  String.raw`'\n'`
                  +
                  `);`
                  +
                  */
                  `\n \t`
                  +
                  `return(BatteryVoltage);`
                  +
                  `\n`
                  +
                  `} //end of function, MeasureVoltage()`
                  +
                  `\n \n`
                  ;
/*Turn off output*/const TurnOffOutputFunction =
                  `void TurnOffOutput()`
                  +
                  `\n`
                  +
                  `{`
                  +
                  `\n \t`
                  +
                  `digitalWrite(RelayOutput, LOW);  // sets the relay output off`
                  +                  
                  `\n \t`
                  +
                  `OutputState = 0;`
                  +
                  `\n \t`
                  //+
                  //`Serial.print(DeviceName +"Output disconnected.");`
                  +
                  `\n`
                  +
                  `} //end of function, TurnOffOutput()`
                  +
                  `\n`
                  ;
/*Turn on output*/const TurnOnOutputFunction =
                  `void TurnOnOutput() `
                  +
                  `\n`
                  +
                  `{`
                  +
                  `\n \t`
                  +
                  `digitalWrite(RelayOutput, HIGH);  // sets the relay output on`
                  +
                  `\n \t`
                  +
                  `OutputState = 1;`
                  //+
                  //`Serial.print(DeviceName +"Output connected.");`
                  +
                  `\n`
                  +
                  `} //end of function, TurnOnOutput()`
                  +
                  `\n`
                  ;
/*Void Setup*/    const SetupFunction =
                  `void setup()`
                  +
                  `\n`
                  +
                  `{`
                  +
                  `\n \t`
                  +
                  `// Initialize serial communication`
                  +
                  `\n \t`
                  +
                  `lcd.init(); // initialize the lcd` 
                  +
                  `\n \t`
                  +
                  `lcd.backlight();`
                  +
                  `\n \t`
                  + 
                  `\n \t`
                  +
                  `//Button Initialization`
                  +
                  `\n \t`
                  +
                  `pinMode(InputUp, INPUT);`
                  + 
                  `\n \t`
                  +
                  `pinMode(InputDown, INPUT);`    
                  + 
                  `\n \t`
                  +
                  `pinMode(InputLeft, INPUT);`
                  + 
                  `\n \t`
                  +
                  `pinMode(InputRight, INPUT);` 
                  + 
                  `\n \t`
                  +
                  `pinMode(InputSelect, INPUT);`  
                  + 
                  `\n \t`
                  +
                  `selectPressed = true;`  // Initialize the select button latch
                  + 
                  `\n \t`
                  +
                  `Serial.begin(9600);`
                  +
                  `\n \t`
                  +
                  `readUserInput();`
                  +
                  `\n \t`
                  +
                  `TurnOnOutput(); //we want to start the microcontroller with the output on`
                  +
                  `\n`
                  +
                  `} //End of void setup`
                  +
                  `\n \n`
                  ;
                                    
                                    
/*Void Default Screen State*/const DefaultMenuPageScreenstate =
                  `\n \t`
                  +
                  `enum State`
                  +
                  `\n \t`
                  +
                  `{`
                  +
                  `\n \t \t`
                  +
                  `SCROLLING,`
                  +
                  `\n \t \t`
                  +
                  `SELECTING`
                  +
                  `\n \t`
                  +
                  `};`
                  +
                  `\n \n \t`
                  +
                  `State currentState = SCROLLING;`
                  +
                  `\n \t`
                  +
                  `\n \t`
                  +
                  `enum Page`
                  + 
                  `{`
                  +
                  `\n \t \t`
                  +
                  `STATUS_PAGE,`
                  +
                  `\n \t \t`
                  +
                  `MENU_PAGE,`
                  +
                  `\n \t \t`
                  +
                  `NOMINAL_VOLTAGE_PAGE,`
                  +
                  `\n \t \t`
                  +
                  `CUT_OFF_VOLTAGE_PAGE,`
                  +
                  `\n \t \t`
                  +
                  `RECONNECT_VOLTAGE_PAGE,`
                  +
                  `\n \t \t`
                  +
                  `OVERRIDE_TIME_PAGE`
                  +
                  `\n \t \t`
                  +
                  `// Add more pages as needed`
                  +
                  `\n \t \t`
                  +
                  `};`
                  +
                  `\n \t \t`
                  +
                  `Page currentPage = STATUS_PAGE;`
                  +
                  `\n \t`
                  ;

                                    
/*Low Voltage Check*/const LowVoltageCheck =
                  `//Low voltage disconnection: If the battery voltage is lower than the cut off voltage, turn off the load when the override period expires`
                  +
                  `\n \t`
                  +
                  `static unsigned long StartTime = 0;`
                  +
                  `\n \t`
                  +
                  `static unsigned long EndTime = 0;`
                  +
                  `\n \t`
                  +
                  `static bool TimerHasStarted = false;`
                  +
                  `\n \t`
                  +
                  `if (MeasureVoltage() < ShutOffVoltage)`
                  +
                  `\n \t`
                  +
                  `{`
                  +
                  `\n \t \t`               
                  +
                  `if(TimerHasStarted == false)`
                  +
                  `\n \t \t`
                  +
                  `{`
                  +
                  `\n \t \t \t`
                  +
                  `StartTime = TimeSinceBoot();`
                  +
                  `\n \t \t \t`
                  +
                  `EndTime = SetTimerEnd()+DisconnectBufferTime;`
                  +
                  `\n \t \t \t`
                  +
                  `TimerHasStarted = true;`
                  +
                  `\n \t \t \t`
                  +
                  /*`Serial.print(DeviceName +"Timer started at: ");`
                  +
                  `\n \t \t \t`
                  +
                  `Serial.print(StartTime / 1000); // Convert milliseconds to seconds`
                  +
                  `\n \t \t \t`
                  +
                  `Serial.println(" seconds");`
                  +
                  `\n \t \t \t`
                  +
                  `Serial.print(DeviceName +"Timer will end at: ");`
                  +
                  `\n \t \t \t`
                  +
                  `Serial.print(EndTime / 1000); // Convert milliseconds to seconds`
                  +
                  `\n \t \t \t`
                  +
                  `Serial.println(" seconds");`
                  +
                  `\n \t \t \t`
                  +
                  `Serial.println("Countdown:");`
                  +
                  `\n \t \t`
                  +
                  */
                  `} // end of if TimerHasStarted == false statement`
                  +
                  `\n \t \t \t`
                  +
                  `unsigned long currentTime = TimeSinceBoot();`
                  +
                  `\n \t \t \t`
                  +
                  `if (currentTime < EndTime)`
                  +
                  `\n \t \t \t`
                  +
                  `{`
                  +
                  `\n \t \t \t \t`
                  +
                  `unsigned long remainingTime = EndTime - currentTime;`
                  +
                  `\n \t \t \t \t`
                  +
                  /*`Serial.print(remainingTime / 1000); // Convert milliseconds to seconds`
                  +
                  `\n \t \t \t \t`
                  +
                  `Serial.println(" seconds remaining");`
                  +
                  `\n \t \t \t \t`
                  +
                  */
                  `// Other tasks can run here while the timer is active`
                  +
                  `\n \t \t \t`
                  +
                  `} // end of if(currentTime < EndTime)`
                  +
                  `\n \t \t \t`
                  +
                  `else`
                  +
                  `\n \t \t \t`
                  +
                  `{`
                  +
                  `\n \t \t \t \t`
                  +
                  /*`Serial.println("Timer completed. Load can be turned off.");`
                  +
                  `\n \t \t \t \t`
                  +
                  */
                  `\n \t \t \t \t`
                  +
                  `TurnOffOutput();`
                  +
                  `\n \t \t \t`
                  +
                  `} // end of else statement`
                  +
                  `\n \t \t \t`
                   +
                  `} // end of if MeasureVoltage()<ShutOffVoltage`
                  +
                  `\n \t \t \t`
                  ;
                  
/*Reconnect Voltage Check*/const ReconnectVoltageCheck =
                  `//Reconnection: If the battery voltage has been recharged over the set reconnect voltage, turn the load back on`
                  +
                  `\n \t \t`
                  +
                  `if (MeasureVoltage()>TurnBackOnVoltage)`
                  +
                  `\n \t \t`
                  +
                  `{`
                  +
                  `\n \t \t \t`
                  +
                  `TurnOnOutput();`
                  +
                  `\n \t \t \t`
                  +  
                  `TimerHasStarted = false;`
                  +
                  `\n \t \t`
                  +
                  `} //end of if statement`
                  +
                  `\n \t \t`
                  ;                
                                                       
/*Void Loop*/     const LoopFunction =
                  `\n`
                  +
                  `void loop()`
                  +
                  `\n`
                  +
                  `{`
                  +
                  `\n \t`
                  +
                  `int lastSwitchState;`
 	              +
                  `\n \t`
                  +
                  `int EncoderSelectState = digitalRead(EncoderSW);`
                  +
                  `\n \t`
 	              +
                  `int SELECT_State = digitalRead(InputSelect);`
                  +
                  `\n \t`
                  +
                  `if (EncoderSelectState == LOW && lastEncoderSelectState == HIGH)`
                  +
                  `\n \t \t`
                  +
                  `{`  
                  +
                  `\n \t \t`
                  +
                  `// Update the switch state`
                  +
                  `\n \t \t`
                  +
                  `selectPressed = !selectPressed;` 
                  +
                  `\n \t \t`
                  +
                  `// Toggle the latched state`
                  +
                  `\n \t`
                  +
                  `}`
                  +
                  `\n \t`
                  +
                  `// Update the last state`
                  +
                  `\n \t`
                  +
                  `lastEncoderSelectState = EncoderSelectState;`
                  +
                  `\n \t`
                  + 
              	  `// Check if the encoder button is pressed`
                  +
                  `\n \t`
                  +
                  `\n \t`
                  +
                  `if (selectPressed)`
                  +
                  `\n \t`
                  +
                  `{`
                  +
                  `\n \t \t`
                  +
                  `if (currentPage==STATUS_PAGE && lastEncoderSelectState == LOW)`
                  +
                  `\n \t \t`
                  +
                  `{`
                  +
                  `\n \t \t \t`
                  +
                  `currentPage = MENU_PAGE;`
                  +
                  `\n \t \t`
                  +
                  `currentState = SCROLLING;`
                  +
                  `\n \t \t`
                  +
                  `}`
                  +
                  `\n \t`
                  +
                  `}`
                  +
                  `\n \t`
                  +
                  `else if (currentPage == MENU_PAGE && scrollPosition == 0)`    
                  +
                  `\n \t`
                  +
                  `{`
                  +
                  `\n \t`
                  +
                  `if (!selectPressed)`
                  +
                  `\n \t`
                  +
                  `{`
                  +
                  `\n \t \t`
                  +
                  `currentPage = NOMINAL_VOLTAGE_PAGE;` 
                  +
                  `\n \t`
                  +
                  `currentState = SELECTING;`
                  +
                  `\n \t`
                  +
                  `SelectedPage = 0;`
                  +
                  `\n \t \t`
                  +
                  `}`
                  +
                  `\n \t`
                  +
                  `}`
                  +
                  `\n \t`
                  +
                  `else if (currentPage == MENU_PAGE && scrollPosition == 1)`
                  +
                  `\n \t`    
                  +
                  `{`
                  +
                  `\n \t \t`
                  +
                  `if (!selectPressed)`
                  +
                  `\n \t \t`
                  +
                  `{`
                  +
                  `\n \t \t \t`
                  +
                  `currentPage = CUT_OFF_VOLTAGE_PAGE;` 
                  +
                  `\n \t`
                  +
                  `currentState = SELECTING;`
                  +
                  `\n \t`
                  +
                  `SelectedPage = 1;`
                  +
                  `\n \t \t \t`
                  +
                  `}`
                  +
                  `\n \t \t`
                  +
                  `}`
                  +
                  `\n \t \t`
                  +
                  `else if (currentPage == MENU_PAGE && scrollPosition == 2)`
                  +
                  `\n \t \t`
                  +
                  `{`                 
                  +
                  `\n \t \t`
                  +
                  `if (!selectPressed)`
                  +
                  `\n \t \t`
                  +
                  `{`
                  +
                  `currentPage = RECONNECT_VOLTAGE_PAGE;` 
                  +
                  `\n \t`
                  +
                  `currentState = SELECTING;`
                  +
                  `\n \t`
                  +                  
                  `SelectedPage = 2;`
                  +
                  `} //end if (!selectPressed)`
                  +
                  `\n \t`
                  +
                  `} // end else if (currentPage == MENU_PAGE && scrollPosition == 2)`
                  +
                  `\n \t`
                  +
                  `else if (currentPage == MENU_PAGE && scrollPosition == 3)`
                  +
                  `\n \t`
                  +
                  `{`
                  +
                  `\n \t`
                  +
                  `if (!selectPressed)`
                  +
                  `\n \t`
                  +
                  `{`
                  +
                  `\n \t`
                  +
                  `currentPage = OVERRIDE_TIME_PAGE;`
                  +
                  `\n \t`
                  +
                  `currentState = SELECTING;`
                  +
                  `\n \t`
                  +
                  `SelectedPage = 3;`
                  +
                  `} //if (!selectPressed)`
                  +
                  `\n \t`
                  +
                  `}// else if`
                  +
                `\n \t`
                +
                `else if( currentPage == NOMINAL_VOLTAGE_PAGE || currentPage == CUT_OFF_VOLTAGE_PAGE || currentPage == RECONNECT_VOLTAGE_PAGE || currentPage == OVERRIDE_TIME_PAGE)`
                +
                `\n \t \t`
                +
                `{`
                 +
                `\n \t \t \t`
                +
                `ReturnToStatusPage = true;`
                +
                `\n \t \t`
                +
                `} //end else if`
                +
                `\n \t`
                +
                `if(selectPressed && ReturnToStatusPage == true)`
                +
                `\n \t`
                +
                `{`
                +
                `\n \t`
                +
                `currentPage = STATUS_PAGE;`
                +
                `\n \t`
                +
                `currentState = SCROLLING;`
                +
                `\n \t`
                +
                `EncoderSelectState = HIGH;`
                +  
                `\n \t`
                +
                `ReturnToStatusPage = false;`
                + 
                `\n \t`
                +
                `} //end if`
                +
                `\n \t`
                +
                `switch (currentPage)`
                +
                `\n \t`
                +
                `{` 
                +
                `case STATUS_PAGE:`
                +
                `\n \t \t`
                +
                `StatusPageScreen();`
                +
                `\n \t \t`
                +
                `break;`
                +
                `\n \t \t`
                +
                `case MENU_PAGE:`
                +
                `\n \t \t`
                +
                `MenuPageScreens(scrollPosition);`
                +
                `\n \t \t`
                +
                `break;`
                +
                `\n \t \t`
                +
                `case NOMINAL_VOLTAGE_PAGE:`
                +
                `\n \t \t`
                +
                `AdjustNominalVoltage();`
                +
                `\n \t \t`
                +
                `break;`
                +
                `\n \t \t`
                +
                `case CUT_OFF_VOLTAGE_PAGE:`
                +
                `\n \t \t`
                +
                `AdjustCutOffVoltagePage();`
                +
                `\n \t \t`
                +
                `break;`
                +
                `\n \t \t`
                +
                `case RECONNECT_VOLTAGE_PAGE:`
                +
                `\n \t \t`
                +
                `AdjustReconnectVoltagePage();`
                +
                `\n \t \t`
                +
                `break;`
                +
                `\n \t \t`
                +
                `case OVERRIDE_TIME_PAGE:`
                +
                `\n \t \t`
                +
                `AdjustOverrideTimePage();`
                +
                `\n \t \t`
                +
                `break;`
                +
                `\n \t \t`
                +
                `}`
                +
                  `\n \t`
                  +
                  `Scroll();`
                  +
                  `\n \t`
                  +
                  LowVoltageCheck
                  +
                  `Scroll();`
                  +
                  `\n \t`
                  +
                  ReconnectVoltageCheck
                  +
                  `Scroll();`
                  +
                  `\n \t` 
                  +
                  `EncoderSelectState = digitalRead(EncoderSW);`
                  +
                  `\n \t` 
                  +
                  `SELECT_State = digitalRead(InputSelect);`
                  +
                  `\n \t `
                  +
                  `switch (currentState)`
                  +
                  `\n \t` 
                  +
                  `{`
                  +
                  `\n \t` 
                  +
                  `case SCROLLING:`
                  +
                  `\n \t` 
                  +
                  `Scroll();`
                  +
                  `\n \t`
                  +
                  `break;`
                  +
                  `\n \t` 
                  +
                  `case SELECTING:`
                  +
                  `\n \t` 
                  +
                  `// Perform actions when the select is pressed`
                  +
                  `\n \t` 
                  +
                  `Select(SelectedPage);`
                  +
                  `\n \t` 
                  +
                  `// Transition back to SCROLLING state if select is released`
                  +
                  `\n \t` 
                  +
                  `break;`
                  +
                  `\n \t` 
                  +
                  `} //end of case SELECTING`
                  +
                  `\n \t` 
                  +
                  `} //End of Void Loop`
                  ;//end of arduinoCode constant
            
        //select the control scheme to put into the Blob     
        
        if(ControlSelection == 1)
        {
            var ScrollFunction = ButtonScrollFunction;
            var SelectFunction = ButtonSelectFunction;
            var LibrariesSection = LibrariesSectionButtonArray;    
        }
        if(ControlSelection ==2)
        {
            var ScrollFunction = EncoderScrollFunction;
            var SelectFunction = EncoderSelectFunction;
            var LibrariesSection = LibrariesSectionEncoder;
        }
            
        // Create a Blob containing the Arduino code
        const blob = new Blob([CodeHead + LibrariesSection + MenuItems + LiquidCrystalDisplayVariablesSection + VoltageProbeSpecifications + GlobalVariables + TimerRelatedVariables + GetPinAssignments + EncoderSetup + StatusPage + MenuPage + NominalVoltagePage + ScrollFunction + SelectFunction + ReadUserInputMemoryFunction + WriteUserInputMemoryFunction + TimeSinceBootFunction + StartTimerFunction + VoltageMeasurementFunction + TurnOffOutputFunction + TurnOnOutputFunction + SetupFunction + DefaultMenuPageScreenstate  + LoopFunction], { type: 'text/plain' });

        // Create a download link
        const downloadLink = document.getElementById("downloadLink");
        downloadLink.href = URL.createObjectURL(blob);
        downloadLink.download = "arduino_code.ino"; // Set the filename

        downloadLink.style.display = "block";
        }//end else
    }//end function generate code     
    </script>

  </body>
</html>
