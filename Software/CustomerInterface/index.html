<!DOCTYPE html>

<!--Low voltage disconnect customer form
    Programmed by Henry Holben and Weston Street using some code generated by ChatGPT, https://chat.openai.com/


-->

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arduino Code Generator</title>

		<form>

        
        <!--Device Name-->
            <h3>Device Name</h3>
            <label for="DeviceName">Device Name:</label>
            <br>
            <input type="text" id="DeviceName" name="DeviceName" value="Theophilus">
            <br>
            <input type="checkbox" id="EnableNameChange" name="EnableNameChange" value="true">Allow the user to change the name of their low voltage disconnect
            <br>
        
        <!--Nominal Voltage-->
            <h3>Nominal voltage</h3>
            <label for="NominalVoltage">Enter NominalVoltage Value:</label>
            <input type="number" id="NominalVoltage" name="NominalVoltage" value="12" required> volts
            <br>
            <span class="error" id="NominalVoltageError" style="color:red"></span><br><br>
            <br>
            <input type="checkbox" id="EnableNominalVoltageInterface" name="EnableNominalVoltageInterface" value="true" checked="checked"> <!-- selected by default-->Allow the user to change the nominal voltage <br>
            <br>
        
        <!--Shut off Voltage Form-->
            <h3>Shut Off voltage</h3>
            <label for="ShutOffVoltage">Enter ShutOffVoltage Value:</label> volts
            <input type="number" id="ShutOffVoltage" name="ShutOffVoltage" value="6" required> volts
            <span class="error" id="ShutOffVoltageError"></span><br><br><br>
            <input type="checkbox" id="EnableShutOffVoltageInterface" name="EnableShutOffVoltageInterface" value="ShutOffEnabled"  checked="checked"> <!-- selected by default-->Allow the user to change the turn-back-on voltage <br>
<br>
        <!-- Shut Off Voltage Timer-->
            <h3>Shut Off Voltage Timer:</h3>
            <p>This is a buffer period meant to prevent the LVDC from disconnecting prematurely on account of current spikes, troughs, or noise.</p>
            <input type="number" id="ShutOffVoltageTimer" name="ShutOffVoltageTimer" value="30"> seconds
            <br>
            <input type="checkbox" id="EnableShutOffVoltageTimerBoolean" name="EnableShutOffVoltageTimerBoolean" value="TRUE">
            <label for="EnableTimerOffsetBoolean">Check to enable changing of shut off voltage timer</label><br>
        
        
        <!--Turn Back on Voltage Form-->
            <h3>Turn-back on Voltage:</h3>
            <input type="number" id="TurnBackOnVoltage" name="TurnBackOnVoltage" value="10"> volts
            <br>
            <input type="checkbox" id="EnableTurnBackOnVoltageInterface" name="EnableTurnBackOnVoltageInterface" value="TurnBackOnEnabled" checked="checked"> <!-- selected by default-->
            <label for="TurnBackOnVoltage">Allow the user to change the turn-back-on voltage</label><br>
        

        <!-- Override-->
            <h3>Overide:</h3>
            <input type="number" id="OverrideDelay" name="OverrideDelay" value="20"> minutes
            <br>
            <input type="checkbox" id="override" name="override" value="TRUE" checked="checked"> <!-- selected by default-->
            <label for="override">Check to change overide delay time</label><br>
            <br>
            <br>
        
        <!-- TimerOffset-->
            <h3>Timer Offset:</h3>
            <input type="number" id="TimerOffset" name="TimerOffset" value="0"> seconds
            <br>
            <input type="checkbox" id="EnableTimerOffsetBoolean" name="EnableTimerOffsetBoolean" value="TRUE">
            <label for="EnableTimerOffsetBoolean">Check to enable changing of the timer offset</label><br>
        
        <!-- Language-->
            <h3>Language:</h3>
            Default Language:
            <br>
            <input type="radio" id="english" name="LanguageSetting" value="english" checked="checked"> <!-- selected by default-->
            <label for="english">English</label> 
            <input type="radio" id="spanish" name="LanguageSetting" value="spanish">
            <label for="spanish">Spanish</label><br>
            <br>
            <br>
            <input type="checkbox" id="EnableLanguageInterface" name="EnableLanguageInterface" value="LanguageChoiceEnabled">
            <label for="EnableLanguageInterface">Check to enable language selection</label><br>
            <br>
        
        <!-- Board-->
            <h3>Board:</h3>
            Select a device:
            <br>
            <input type="radio" id="ArduinoNano" name="DeviceSetting" value="ArduinoNano">
            <label for="ArduinoNano">Arduino Nano</label> 
            <br>
            <input type="radio" id="ArduinoNanoESP32" name="DeviceSetting" value="ArduinoNanoESP32">
            <label for="ArduinoNanoEsp32">Arduino Nano ESP 32</label>
            <br>
            <input type="radio" id="ArduinoUno" name="DeviceSetting" value="ArduinoUno" checked="checked"> <!-- selected by default-->
            <label for="ArduinoUno">Arduino Uno</label> 
            <br>
            <input type="radio" id="ArduinoMega" name="DeviceSetting" value="ArduinoMega">
            <label for="ArduinoMega">Arduino Mega</label><br>

        <!-- Controller type-->
            <h3>Controller type:</h3>
            Select a controller type:
            <br>
            <input type="radio" id="ButtonArray" name="ControlTypeSetting" value="ButtonArray" checked="checked"> <!-- selected by default-->
            <label for="ButtonArray">Array of 5  push buttons</label> 
            <br>
            <input type="radio" id="Encoder" name="ControlTypeSetting" value="Encoder">
            <label for="Encoder">Rotary Encoder</label><br>
            <br>

        <!-- Output type-->
            <h3>Output Type:</h3>
            Select what hardware is to be to be used to power on the load:
            <br>
            <input type="radio" id="RelayOutput" name="OutputType" value="RelayOutput" checked="checked"> <!-- default-->
            <label for="RelayOutput">Mechanical Relay</label> 
            <br>
            <input type="radio" id="InverterControl" name="OutputType" value="InverterControl">
            <label for="InverterControl">Inverter Data Cable</label><br>
            <br>

        <!--Buttons to begin the generation of the arduino file:-->
            <button type="button" onclick="generateCode()">Generate Arduino Code</button>
            <br>            

        
    </form>
    
    <br>
    
    <a id="downloadLink" style="display: none" download="arduino_code.ino">Download Arduino Code</a>
    

<!--Rhe javascript files that are stored in this folderun t-->
<script src = "PinData.js" defer></script>
<script src = "ExtractFormVariables.js" defer></script>
<script src = "ConvertMenuItemsToString.js" defer></script>

<script src = "Explanations.js" defer></script>

<script src = "CodeHead.js" defer></script>
<script src = "LibrariesSection.js" defer></script>
<script src = "InitialCppVariables.js" defer></script>
<script src = "PagesLCD.js" defer></script>
<script src = "ScrollFunctions.js" defer></script>
<script src = "SelectFunctions.js" defer></script>
<script src = "MemoryFunctions.js" defer></script>
<script src = "MeasurementFunction.js" defer></script>

<script src = "TimerFunctions.js" defer></script>
<script src = "OutputTogglingFunctions.js" defer></script>
<script src = "VoltageCheckRoutines.js" defer></script>
<script src = "SetupFunction.js" defer></script>
<script src = "VoidLoop.js" defer></script>



    <script type="text/javascript">
        

  //A potential alternative to running the scripts as we did above, is to combine them into one large script:     
        /* Pure Javascript work*/

            //Set pin assignments
              //  let PinDataScript = document.createElement('script');
               // PinDataScript.src ="PinData.js";
                //PinDataScript.defer = true;
               // document.head.appendChild(PinDataScript);

            //Extract Variables from the HTML form
             //   let ExtractVariablesScript = document.createElement('script');
              //  ExtractVariablesScript.src ="ExtractFormVariables.js";
              //  ExtractVariablesScript.defer = true;
              //  document.head.appendChild(ExtractVariablesScript);

            //Convert the menu items selected by the user to a string
               // let ConvertMenuToStringScript = document.createElement('script');
               // ConvertMenuToStringScript.src ="ConvertMenuItemsToString.js";
               // ConvertMenuToStringScript.defer = true;
               // document.head.appendChild(ConvertMenuToStringScript);

            //Explanations to potentially appear on the index page as a guide for the user
               // let ExplanationsScript = document.createElement('script');
                //ExplanationsScript.src ="Explanations.js";
                //ExplanationsScript.defer = true;
               // document.head.appendChild(ExplanationsScript);




        /*Javascripts that declare strings of C++: */


            //Code Head
                //let CodeHeadscript = document.createElement('script');
                //CodeHeadscript.src ="CodeHead.js";
                //CodeHeadscript.defer = true;
                //document.head.appendChild(CodeHeadscript);

            //Libraries Section
              // let LibrariesSectionScript = document.createElement('script');
              //  LibrariesSectionScript.src ="LibrariesSection.js";
              //  LibrariesSectionScript.defer = true;
              // document.head.appendChild(LibrariesSectionScript);

            //Initial Variables
              //  let InitialCppVariablesScript = document.createElement('script');
              //  InitialCppVariablesScript.src ="InitialCppVariables.js";
              //  InitialCppVariablesScript.defer = true;
              //  document.head.appendChild(InitialCppVariablesScript);

            //LCD Pages
              //  let LCDpagesScript = document.createElement('script');
               // LCDpagesScript.src ="PagesLCD.js";
              //  LCDpagesScript.defer = true;
              //  document.head.appendChild(LCDpagesScript);

            //Scroll Functions
               // let ScrollFunctionsScript = document.createElement('script');
               // ScrollFunctionsScript.src ="ScrollFunctions.js";
               // ScrollFunctionsScript.defer = true;
                //document.head.appendChild(ScrollFunctionsScript);

            //Select Functions
               // let SelectFunctionsScript = document.createElement('script');
               // SelectFunctionsScript.src ="SelectFunctions.js";
                //SelectFunctionsScript.defer = true;
                //document.head.appendChild(SelectFunctionsScript);

            //Memory Functions
               // let MemoryFunctionsScript = document.createElement('script');
               // MemoryFunctionsScript.src ="MemoryFunctions.js";
              //  MemoryFunctionsScript.defer = true;
               // document.head.appendChild(MemoryFunctionsScript);

            //Timer Functions
                //let TimerFunctionsScript = document.createElement('script');
               // TimerFunctionsScript.src ="TimerFunctions.js";
               // TimerFunctionsScript.defer = true;
               // document.head.appendChild(TimerFunctionsScript);

            //Votlage Measurement Function
              //let VoltageMeasurementScript = document.createElement('script');
            //  VoltageMeasurementScript.src ="MeasurementFunction.js";
           //  VoltageMeasurementScript.defer = true;
          //  document.head.appendChild(VoltageMeasurementScript);
  
            //Functions for turning the output on or off
              // let OutputTogglingFunctionsScript = document.createElement('script');
              // OutputTogglingFunctionsScript.src ="OutputTogglingFunctions.js";
              // OutputTogglingFunctionsScript.defer = true;
              // document.head.appendChild(OutputTogglingFunctionsScript);

            //Voltage Check Routines
              //  let VoltageCheckRoutinesScript = document.createElement('script');
          //  VoltageCheckRoutinesScript.src ="VoltageCheckRoutines.js";
          //      VoltageCheckRoutinesScript.defer = true;
          //      document.head.appendChild(VoltageCheckRoutinesScript);
            
            //Setup Function
           //     SetupFunctionScript = document.createElement('script');
           //     SetupFunctionScript.src ="SetupFunction.js";
           //     SetupFunctionScript.defer = true;
           //     document.head.appendChild(SetupFunctionScript);





            
        //Generate the arduino Code
        function generateCode() 
        {

            //Check that inputs are valid       
                const NominalVoltageError = document.getElementById('NominalVoltageError');
                const ShutOffVoltageError = document.getElementById('ShutOffVoltageError');
                NominalVoltageError.textContent = '';
                ShutOffVoltageError.textContent = '';

                if (!NominalVoltage) 
                {

       alert("Please enter a positive integer multiple of 12 for Nominal Voltage.");
                }
            
                else if (NominalVoltage % 12 !== 0) 
                {
       NominalVoltageError.textContent = 'Please enter a positive integer multiple of 12 for Nominal Voltage.';
       alert("Nominal Voltage must be a positive integer multiple of 12.");
                }

                else if (isNaN(ShutOffVoltage) || ShutOffVoltage <= 0) 
                {
        alert("Please enter a positive number for Shut Off VOltage (decimal values allowed");
                }
                
                else if (isNaN(TurnBackOnVoltage) || TurnBackOnVoltage <= 0) 
                {
        alert("Please enter a positive number for Turn Back On Voltage(decimal values allowed");
                }
                else if (isNaN(OverrideDelay) || TurnBackOnVoltage <= 0) 
                {
        alert("Please enter a positive number for override delay (decimal values allowed");
                }
                else //allow the code to run as normal
                {
                    //select the control scheme to put into the Blob     
                    if(ControlSelection == 1)
                    {
                        var ScrollFunction = ButtonScrollFunction;
                        var SelectFunction = ButtonSelectFunction;
                        var LibrariesSection = LibrariesSectionButtonArray; 
                        var SetUpFunction = SetupFunctionButtons;
                        var ControlSchemeGlobalVariables = ButtonRelatedGlobalVariables;
                    }
                    else if(ControlSelection ==2)
                    {
                        var ScrollFunction = EncoderScrollFunction;
                        var SelectFunction = EncoderSelectFunction;
                        var LibrariesSection = LibrariesSectionEncoder;
                        var SetUpFunction = SetupFunctionEncoder;
                        var ControlSchemeGlobalVariables = EncoderRelatedGlobalVariables;
                    }

                    // Create a Blob containing the Arduino code
                    const blob = new Blob(
                    [
                        CodeHead 
                        + 
                        LibrariesSection 
                        + 
                        MenuItems 
                        + 
                        LiquidCrystalDisplayVariablesSection 
                        + 
                        VoltageProbeSpecifications 
                        + 
                        GlobalVariables 
                        + 
                        TimerRelatedVariables 
                        + 
                        GetPinAssignments 
                        + 
                        ControlSchemeGlobalVariables 
                        + 
                        VoltageMeasurementFunction 
                        + 
                        StatusPage 
                        + 
                        MenuPage 
                        + 
                        AdjustNominalVoltagePage 
                        + 
                        AdjustCutOffVoltagePage
                        +
                        AdjustReconnectVoltagePage
                        +
                        AdjustOverrideTimePage
                        +
                        ScrollFunction 
                        + 
                        SelectFunction 
                        + 
                        ReadUserInputMemoryFunction 
                        + 
                        WriteUserInputMemoryFunction 
                        + 
                        TimeSinceBootFunction 
                        + 
                        DisconnectBufferTimerEnd 
                        + 
                        OverrideTimerEnd 
                        +
                        TurnOffOutputFunction 
                        + 
                        TurnOnOutputFunction 
                        + 
                        SetUpFunction 
                        + 
                        DefaultMenuPageScreenState  
                        +
                        LoopFunctionStart
                        +
                        LoopFunctionPages
                    ], { type: 'text/plain' });

                    // Create a download link
                    const downloadLink = document.getElementById("downloadLink");
                    downloadLink.href = URL.createObjectURL(blob);
                    downloadLink.download = "arduino_code.ino"; // Set the filename

                    downloadLink.style.display = "block";
                }//end else
        }//end function generate code     
    </script>



  </body>
</html>
