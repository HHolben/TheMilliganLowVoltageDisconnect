<!DOCTYPE html>

<!--Low voltage disconnect customer form
    Programmed by Henry Holben and Weston Street using some code generated by ChatGPT, https://chat.openai.com/


-->

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arduino Code Generator</title>

		<form>

        
        <!--Device Name-->
            <h3>Device Name</h3>
            <label for="DeviceName">Device Name:</label>
            <br>
            <input type="text" id="DeviceName" name="DeviceName" value="Theophilus">
            <br>
            <input type="checkbox" id="EnableNameChange" name="EnableNameChange" value="true">Allow the user to change the name of their low voltage disconnect
            <br>
        
        <!--Nominal Voltage-->
            <h3>Nominal voltage</h3>
            <label for="NominalVoltage">Enter NominalVoltage Value:</label>
            <input type="number" id="NominalVoltage" name="NominalVoltage" value="12" required> volts
            <br>
            <span class="error" id="NominalVoltageError" style="color:red"></span><br><br>
            <br>
            <input type="checkbox" id="EnableNominalVoltageInterface" name="EnableNominalVoltageInterface" value="true" checked="checked">Allow the user to change the nominal voltage <br>
            <br>
        
        <!--Shut off Voltage Form-->
            <h3>Shut Off voltage</h3>
            <label for="ShutOffVoltage">Enter ShutOffVoltage Value:</label> volts
            <input type="number" id="ShutOffVoltage" name="ShutOffVoltage" value="6" required> volts
            <span class="error" id="ShutOffVoltageError"></span><br><br><br>
            <input type="checkbox" id="EnableShutOffVoltageInterface" name="EnableShutOffVoltageInterface" value="ShutOffEnabled">Allow the user to change the turn-back-on voltage <br>
<br>
        <!-- Shut Off Voltage Timer-->
            <h3>Shut Off Voltage Timer:</h3>
            <p>This is a buffer period meant to prevent the LVDC from disconnecting prematurely on account of current spikes, troughs, or noise.</p>
            <input type="number" id="ShutOffVoltageTimer" name="ShutOffVoltageTimer" value="30"> seconds
            <br>
            <input type="checkbox" id="EnableShutOffVoltageTimerBoolean" name="EnableShutOffVoltageTimerBoolean" value="TRUE">
            <label for="EnableTimerOffsetBoolean">Check to enable changing of shut off voltage timer</label><br>
        
        
        <!--Turn Back on Voltage Form-->
            <h3>Turn-back on Voltage:</h3>
            <input type="number" id="TurnBackOnVoltage" name="TurnBackOnVoltage" value="10"> volts
            <br>
            <input type="checkbox" id="EnableTurnBackOnVoltageInterface" name="EnableTurnBackOnVoltageInterface" value="TurnBackOnEnabled">
            <label for="TurnBackOnVoltage">Allow the user to change the turn-back-on voltage</label><br>
        

        <!-- Override-->
            <h3>Overide:</h3>
            <input type="number" id="OverrideDelay" name="OverrideDelay" value="20"> minutes
            <br>
            <input type="checkbox" id="override" name="override" value="TRUE">
            <label for="override">Check to change overide delay time</label><br>
            <br>
            <br>
        
        <!-- TimerOffset-->
            <h3>Timer Offset:</h3>
            <input type="number" id="TimerOffset" name="TimerOffset" value="0"> seconds
            <br>
            <input type="checkbox" id="EnableTimerOffsetBoolean" name="EnableTimerOffsetBoolean" value="TRUE">
            <label for="EnableTimerOffsetBoolean">Check to enable changing of the timer offset</label><br>
        
        <!-- Language-->
            <h3>Language:</h3>
            Default Language:
            <br>
            <input type="radio" id="english" name="LanguageSetting" value="english" checked="checked">
            <label for="english">English</label> 
            <input type="radio" id="spanish" name="LanguageSetting" value="spanish">
            <label for="spanish">Spanish</label><br>
            <br>
            <br>
            <input type="checkbox" id="EnableLanguageInterface" name="EnableLanguageInterface" value="LanguageChoiceEnabled">
            <label for="EnableLanguageInterface">Check to enable language selection</label><br>
            <br>
        
        <!-- Board-->
            <h3>Board:</h3>
            Select a device:
            <br>
            <input type="radio" id="ArduinoNano" name="DeviceSetting" value="ArduinoNano" checked="checked">
            <label for="ArduinoNano">Arduino Nano</label> 
            <br>
            <input type="radio" id="ArduinoNanoESP32" name="DeviceSetting" value="ArduinoNanoESP32">
            <label for="ArduinoNanoEsp32">Arduino Nano ESP 32</label>
            <br>
            <input type="radio" id="ArduinoUno" name="DeviceSetting" value="ArduinoUno">
            <label for="ArduinoUno">Arduino Uno</label> 
            <br>
            <input type="radio" id="ArduinoMega" name="DeviceSetting" value="ArduinoMega">
            <label for="ArduinoMega">Arduino Mega</label><br>

        <!-- Controller type-->
            <h3>Controller type:</h3>
            Select a controller type:
            <br>
            <input type="radio" id="ButtonArray" name="ControlTypeSetting" value="ButtonArray" checked="checked">
            <label for="ButtonArray">Array of 5  push buttons</label> 
            <br>
            <input type="radio" id="Encoder" name="ControlTypeSetting" value="Encoder">
            <label for="Encoder">RotaryEncoder</label><br>
            <br>

        <!--Buttons to begin the generation of the arduino file:-->
            <button type="button" onclick="generateCode()">Generate Arduino Code</button>
            <br>            

        
    </form>
    
    <br>
    
    <a id="downloadLink" style="display: none" download="arduino_code.ino">Download Arduino Code</a>
    

    <script type="text/javascript">
        
        /* Pure Javascript work*/

            //Set pin assignments
                let PinDataScript = document.createElement('script');
                PinDataScript.src ="PinData.js";
                document.head.appendChild(PinDataScript);

            //Extract Variables from the HTML form
                let ExtractVariablesScript = document.createElement('script');
                ExtractVariablesScript.src ="ExtractFormVariables.js";
                document.head.appendChild(ExtractVariablesScript);

            //Explanations to potentially appear on the index page as a guide for the user
                let ExplanationsScript = document.createElement('script');
                ExplanationsScript.src ="Explanations.js";
                document.head.appendChild(ExplanationsScript);

            //Convert the menu items selected by the user to a string
                let ConvertMenuToStringScript = document.createElement('script');
                ConvertMenuToStringScript.src ="ConvertMenuItemsToString.js";
                document.head.appendChild(ConvertMenuToStringScript);


        /*Javascripts that declare strings of C++: */


            //Code Head
                let CodeHeadscript = document.createElement('script');
                CodeHeadscript.src ="CodeHead.js";
               document.head.appendChild(CodeHeadscript);

            //Libraries Section
               let LibrariesSectionScript = document.createElement('script');
                LibrariesSectionScript.src ="LibrariesSection.js";
               document.head.appendChild(LibrariesSectionScript);

            //Initial Variables
                let InitialCppVariablesScript = document.createElement('script');
                InitialCppVariablesScript.src ="InitialCppVariables.js";
                document.head.appendChild(InitialCppVariablesScript);

            //Encoder setup
                let EncoderSetupScript = document.createElement('script');
                EncoderSetupScript.src ="EncoderSetup.js";
                document.head.appendChild(EncoderSetupScript);

            //LCD Pages
                let LCDpagesScript = document.createElement('script');
                LCDpagesScript.src ="PagesLCD.js";
                document.head.appendChild(LCDpagesScript);

            //Scroll Functions
                let ScrollFunctionsScript = document.createElement('script');
                ScrollFunctionsScript.src ="ScrollFunctions.js";
                document.head.appendChild(ScrollFunctionsScript);

            //Select Functions
                let SelectFunctionsScript = document.createElement('script');
                SelectFunctionsScript.src ="SelectFunctions.js";
                document.head.appendChild(SelectFunctionsScript);

            //Memory Functions
                let MemoryFunctionsScript = document.createElement('script');
                MemoryFunctionsScript.src ="MemoryFunctions.js";
                document.head.appendChild(MemoryFunctionsScript);

            //Timer Functions
                let TimerFunctionsScript = document.createElement('script');
                TimerFunctionsScript.src ="TimerFunctions.js";
                document.head.appendChild(TimerFunctionsScript);

            //Votlage Measurement Function
                let VoltageMeasurementScript = document.createElement('script');
                VoltageMeasurementScript.src ="MeasurementFunction.js";
                document.head.appendChild(VoltageMeasurementScript);
            
            //Functions for turning the output on or off
                let OutputTogglingFunctionsScript = document.createElement('script');
                OutputTogglingFunctionsScript.src ="OutputTogglingFunctions.js";
                document.head.appendChild(OutputTogglingFunctionsScript);

            //Voltage Check Routines
                let VoltageCheckRoutinesScript = document.createElement('script');
                VoltageCheckRoutinesScript.src ="VoltageCheckRoutines.js";
                document.head.appendChild(VoltageCheckRoutinesScript);
            
            //Setup Function
                SetupFunctionScript = document.createElement('script');
                SetupFunctionScript.src ="SetupFunction.js";
                document.head.appendChild(SetupFunctionScript);


            
        //Generate the arduino Code
        function generateCode() 
        {



                     //Check that inputs are valid       
                                const NominalVoltageError = document.getElementById('NominalVoltageError');
                                const ShutOffVoltageError = document.getElementById('ShutOffVoltageError');

            
                                NominalVoltageError.textContent = '';
                                ShutOffVoltageError.textContent = '';

                                if (!NominalVoltage) 
                                {

                                    alert("Please enter a positive integer multiple of 12 for Nominal Voltage.");
                                }
            
                                else if (NominalVoltage % 12 !== 0) 
                                {
                                    NominalVoltageError.textContent = 'Please enter a positive integer multiple of 12 for Nominal Voltage.';
                                    alert("Nominal Voltage must be a positive integer multiple of 12.");
                                }

                                else if (isNaN(ShutOffVoltage) || ShutOffVoltage <= 0) 
                                {
                                     alert("Please enter a positive number for Shut Off VOltage (decimal values allowed");
                                }
                                
                                else if (isNaN(TurnBackOnVoltage) || TurnBackOnVoltage <= 0) 
                                {
                                     alert("Please enter a positive number for Turn Back On Voltage(decimal values allowed");
                                }
                                else if (isNaN(OverrideDelay) || TurnBackOnVoltage <= 0) 
                                {
                                     alert("Please enter a positive number for override delay (decimal values allowed");
                                }
                                else
                                {
            



                                    /*Void Loop*/     const LoopFunction =
                  `\n`
                  +
                  `void loop()`
                  +
                  `\n`
                  +
                  `{`
                  +
                  `\n \t`
                  +
                  `int lastSwitchState;`
 	              +
                  `\n \t`
                  +
                  `int EncoderSelectState = digitalRead(EncoderSW);`
                  +
                  `\n \t`
 	              +
                  `int SELECT_State = digitalRead(InputSelect);`
                  +
                  `\n \t`
                  +
                  `if (EncoderSelectState == LOW && lastEncoderSelectState == HIGH || SELECT_State == LOW)`
                  +
                  `\n \t \t`
                  +
                  `{`  
                  +
                  `\n \t \t`
                  +
                  `// Update the switch state`
                  +
                  `\n \t \t`
                  +
                  `selectPressed = !selectPressed;` 
                  +
                  `\n \t \t`
                  +
                  `// Toggle the latched state`
                  +
                  `\n \t`
                  +
                  `}`
                  +
                  `\n \t`
                  +
                  `// Update the last state`
                  +
                  `\n \t`
                  +
                  `lastEncoderSelectState = EncoderSelectState;`
                  +
                  `\n \t`
                  + 
              	  `// Check if the encoder button is pressed`
                  +
                  `\n \t`
                  +
                  `\n \t`
                  +
                  `if (selectPressed)`
                  +
                  `\n \t`
                  +
                  `{`
                  +
                  `\n \t \t`
                  +
                  `if (currentPage==STATUS_PAGE && lastEncoderSelectState == LOW || (currentPage==STATUS_PAGE && SELECT_State == LOW))`
                  +
                  `\n \t \t`
                  +
                  `{`
                  +
                  `\n \t \t \t`
                  +
                  `currentPage = MENU_PAGE;`
                  +
                  `\n \t \t`
                  +
                  `currentState = SCROLLING;`
                  +
                  `\n \t \t`
                  +
                  `}`
                  +
                  `\n \t`
                  +
                  `}`
                  +
                  `\n \t`
                  +
                  `else if (currentPage == MENU_PAGE && scrollPosition == 0)`    
                  +
                  `\n \t`
                  +
                  `{`
                  +
                  `\n \t`
                  +
                  `if (!selectPressed)`
                  +
                  `\n \t`
                  +
                  `{`
                  +
                  `\n \t \t`
                  +
                  `currentPage = NOMINAL_VOLTAGE_PAGE;` 
                  +
                  `\n \t`
                  +
                  `currentState = SELECTING;`
                  +
                  `\n \t`
                  +
                  `SelectedPage = 0;`
                  +
                  `\n \t \t`
                  +
                  `}`
                  +
                  `\n \t`
                  +
                  `}`
                  +
                  `\n \t`
                  +
                  `else if (currentPage == MENU_PAGE && scrollPosition == 1)`
                  +
                  `\n \t`    
                  +
                  `{`
                  +
                  `\n \t \t`
                  +
                  `if (!selectPressed)`
                  +
                  `\n \t \t`
                  +
                  `{`
                  +
                  `\n \t \t \t`
                  +
                  `currentPage = CUT_OFF_VOLTAGE_PAGE;` 
                  +
                  `\n \t`
                  +
                  `currentState = SELECTING;`
                  +
                  `\n \t`
                  +
                  `SelectedPage = 1;`
                  +
                  `\n \t \t \t`
                  +
                  `}`
                  +
                  `\n \t \t`
                  +
                  `}`
                  +
                  `\n \t \t`
                  +
                  `else if (currentPage == MENU_PAGE && scrollPosition == 2)`
                  +
                  `\n \t \t`
                  +
                  `{`                 
                  +
                  `\n \t \t`
                  +
                  `if (!selectPressed)`
                  +
                  `\n \t \t`
                  +
                  `{`
                  +
                  `currentPage = RECONNECT_VOLTAGE_PAGE;` 
                  +
                  `\n \t`
                  +
                  `currentState = SELECTING;`
                  +
                  `\n \t`
                  +                  
                  `SelectedPage = 2;`
                  +
                  `} //end if (!selectPressed)`
                  +
                  `\n \t`
                  +
                  `} // end else if (currentPage == MENU_PAGE && scrollPosition == 2)`
                  +
                  `\n \t`
                  +
                  `else if (currentPage == MENU_PAGE && scrollPosition == 3)`
                  +
                  `\n \t`
                  +
                  `{`
                  +
                  `\n \t`
                  +
                  `if (!selectPressed)`
                  +
                  `\n \t`
                  +
                  `{`
                  +
                  `\n \t`
                  +
                  `currentPage = OVERRIDE_TIME_PAGE;`
                  +
                  `\n \t`
                  +
                  `currentState = SELECTING;`
                  +
                  `\n \t`
                  +
                  `SelectedPage = 3;`
                  +
                  `} //if (!selectPressed)`
                  +
                  `\n \t`
                  +
                  `}// else if`
                  +
                `\n \t`
                +
                `else if( currentPage == NOMINAL_VOLTAGE_PAGE || currentPage == CUT_OFF_VOLTAGE_PAGE || currentPage == RECONNECT_VOLTAGE_PAGE || currentPage == OVERRIDE_TIME_PAGE)`
                +
                `\n \t \t`
                +
                `{`
                 +
                `\n \t \t \t`
                +
                `ReturnToStatusPage = true;`
                +
                `\n \t \t`
                +
                `} //end else if`
                +
                `\n \t`
                +
                `if(selectPressed && ReturnToStatusPage == true)`
                +
                `\n \t`
                +
                `{`
                +
                `\n \t`
                +
                `currentPage = STATUS_PAGE;`
                +
                `\n \t`
                +
                `currentState = SCROLLING;`
                +
                `\n \t`
                +
                `EncoderSelectState = HIGH;`
                +  
                `\n \t`
                +
                `ReturnToStatusPage = false;`
                + 
                `\n \t`
                +
                `} //end if`
                +
                `\n \t`
                +
                `switch (currentPage)`
                +
                `\n \t`
                +
                `{` 
                +
                `case STATUS_PAGE:`
                +
                `\n \t \t`
                +
                `StatusPageScreen();`
                +
                `\n \t \t`
                +
                `break;`
                +
                `\n \t \t`
                +
                `case MENU_PAGE:`
                +
                `\n \t \t`
                +
                `MenuPageScreens(scrollPosition);`
                +
                `\n \t \t`
                +
                `break;`
                +
                `\n \t \t`
                +
                `case NOMINAL_VOLTAGE_PAGE:`
                +
                `\n \t \t`
                +
                `AdjustNominalVoltage();`
                +
                `\n \t \t`
                +
                `break;`
                +
                `\n \t \t`
                +
                `case CUT_OFF_VOLTAGE_PAGE:`
                +
                `\n \t \t`
                +
                `AdjustCutOffVoltagePage();`
                +
                `\n \t \t`
                +
                `break;`
                +
                `\n \t \t`
                +
                `case RECONNECT_VOLTAGE_PAGE:`
                +
                `\n \t \t`
                +
                `AdjustReconnectVoltagePage();`
                +
                `\n \t \t`
                +
                `break;`
                +
                `\n \t \t`
                +
                `case OVERRIDE_TIME_PAGE:`
                +
                `\n \t \t`
                +
                `AdjustOverrideTimePage();`
                +
                `\n \t \t`
                +
                `break;`
                +
                `\n \t \t`
                +
                `}`
                +
                  `\n \t`
                  +
                  `Scroll();`
                  +
                  `\n \t`
                  +
                  LowVoltageCheck
                  +
                  `Scroll();`
                  +
                  `\n \t`
                  +
                  ReconnectVoltageCheck
                  +
                  `Scroll();`
                  +
                  `\n \t` 
                  +
                  `EncoderSelectState = digitalRead(EncoderSW);`
                  +
                  `\n \t` 
                  +
                  `SELECT_State = digitalRead(InputSelect);`
                  +
                  `\n \t `
                  +
                  `switch (currentState)`
                  +
                  `\n \t` 
                  +
                  `{`
                  +
                  `\n \t` 
                  +
                  `case SCROLLING:`
                  +
                  `\n \t` 
                  +
                  `Scroll();`
                  +
                  `\n \t`
                  +
                  `break;`
                  +
                  `\n \t` 
                  +
                  `case SELECTING:`
                  +
                  `\n \t` 
                  +
                  `// Perform actions when the select is pressed`
                  +
                  `\n \t` 
                  +
                  `Select(SelectedPage);`
                  +
                  `\n \t` 
                  +
                  `// Transition back to SCROLLING state if select is released`
                  +
                  `\n \t` 
                  +
                  `break;`
                  +
                  `\n \t` 
                  +
                  `} //end of case SELECTING`
                  +
                  `\n \t` 
                  +
                  `} //End of Void Loop`
                  ;//end of arduinoCode constant
                          
            
        //select the control scheme to put into the Blob     
        
        if(ControlSelection == 1)
        {
            var ScrollFunction = ButtonScrollFunction;
            var SelectFunction = ButtonSelectFunction;
            var LibrariesSection = LibrariesSectionButtonArray;    
        }
        if(ControlSelection ==2)
        {
            var ScrollFunction = EncoderScrollFunction;
            var SelectFunction = EncoderSelectFunction;
            var LibrariesSection = LibrariesSectionEncoder;
        }
            
        // Create a Blob containing the Arduino code
        const blob = new Blob([CodeHead + LibrariesSection + MenuItems + LiquidCrystalDisplayVariablesSection + VoltageProbeSpecifications + GlobalVariables + TimerRelatedVariables + GetPinAssignments + EncoderSetup + StatusPage + MenuPage + NominalVoltagePage + ScrollFunction + SelectFunction + ReadUserInputMemoryFunction + WriteUserInputMemoryFunction + TimeSinceBootFunction + StartTimerFunction + VoltageMeasurementFunction + TurnOffOutputFunction + TurnOnOutputFunction + SetupFunction + DefaultMenuPageScreenstate  + LoopFunction], { type: 'text/plain' });

        // Create a download link
        const downloadLink = document.getElementById("downloadLink");
        downloadLink.href = URL.createObjectURL(blob);
        downloadLink.download = "arduino_code.ino"; // Set the filename

        downloadLink.style.display = "block";
        }//end else
    }//end function generate code     
    </script>



  </body>
</html>
