<!DOCTYPE html>

<!--Low voltage disconnect customer form
    Programmed by Henry Holben and Weston Street using some code generated by ChatGPT, https://chat.openai.com/


-->

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arduino Code Generator</title>
</head>
<body>
    <h1>Arduino Code Generator</h1>
    <img src="LVDCpreliminarylogoV2.png" alt="LVDC Team Logo: A buff, happy battery in a life saver float" style="width:500px">
    
    <form id="codeForm">
        
        <!--Device Name-->
            <h3>Device Name</h3>
            <label for="DeviceName">Device Name:</label>
            <br>
            <input type="text" id="DeviceName" name="DeviceName" value="Theophilus">
            <br>
            <input type="checkbox" id="EnableNameChange" name="EnableNameChange" value="true">Allow the user to change the name of their low voltage disconnect
            <br>
        
        <!--Nominal Voltage-->
            <h3>Nominal voltage</h3>
            <label for="NominalVoltage">Enter NominalVoltage Value:</label>
            <input type="number" id="NominalVoltage" name="NominalVoltage" value="12" required> volts
            <br>
            <span class="error" id="NominalVoltageError" style="color:red"></span><br><br>
            <br>
            <input type="checkbox" id="EnableNominalVoltageInterface" name="EnableNominalVoltageInterface" value="true" checked="checked">Allow the user to change the nominal voltage <br>
            <br>
        
        <!--Shut off Voltage Form-->
            <h3>Shut Off voltage</h3>
            <label for="ShutOffVoltage">Enter ShutOffVoltage Value:</label> volts
            <input type="number" id="ShutOffVoltage" name="ShutOffVoltage" value="6" required> volts
            <span class="error" id="ShutOffVoltageError"></span><br><br><br>
            <input type="checkbox" id="EnableShutOffVoltageInterface" name="EnableShutOffVoltageInterface" value="ShutOffEnabled">Allow the user to change the turn-back-on voltage <br>
<br>
        <!-- Shut Off Voltage Timer-->
            <h3>Shut Off Voltage Timer:</h3>
            <input type="number" id="ShutOffVoltageTimer" name="ShutOffVoltageTimer" value="0"> seconds
            <br>
            <input type="checkbox" id="EnableShutOffVoltageTimerBoolean" name="EnableShutOffVoltageTimerBoolean" value="TRUE">
            <label for="EnableTimerOffsetBoolean">Check to enable changing of shut off voltage timer</label><br>
        
        
        <!--Turn Back on Voltage Form-->
            <h3>Turn-back on Voltage:</h3>
            <input type="number" id="TurnBackOnVoltage" name="TurnBackOnVoltage" value="10"> volts
            <br>
            <input type="checkbox" id="EnableTurnBackOnVoltageInterface" name="EnableTurnBackOnVoltageInterface" value="TurnBackOnEnabled">
            <label for="TurnBackOnVoltage">Allow the user to change the turn-back-on voltage</label><br>
        
        <!--Current Range-->
            <h3>Current Range:</h3>
            <label for="LowCurrent">Minimum current:</label> amps
            <input type="number" id="LowCurrent" name="LowCurrent" value="10"> amps
            <br>
            <input type="checkbox" id="EnableCurrentRange" name="EnableCurrentRange" value="CurrentEditingEnabled">Allow the user to change the current range. <br>
            <br>
        
        <!-- Override-->
            <h3>Overide:</h3>
            <input type="number" id="OverrideDelay" name="OverrideDelay" value="20"> minutes
            <br>
            <input type="checkbox" id="override" name="override" value="TRUE">
            <label for="override">Check to change overide delay time</label><br>
            <br>
            <br>
        
        <!-- TimerOffset-->
            <h3>Timer Offset:</h3>
            <input type="number" id="TimerOffset" name="TimerOffset" value="0"> seconds
            <br>
            <input type="checkbox" id="EnableTimerOffsetBoolean" name="EnableTimerOffsetBoolean" value="TRUE">
            <label for="EnableTimerOffsetBoolean">Check to enable changing of the timer offset</label><br>
        
        <!-- Language-->
            <h3>Language:</h3>
            Default Language:
            <br>
            <input type="radio" id="english" name="LanguageSetting" value="english" checked="checked">
            <label for="english">English</label> 
            <input type="radio" id="spanish" name="LanguageSetting" value="spanish">
            <label for="spanish">Spanish</label><br>
            <br>
            <br>
            <input type="checkbox" id="EnableLanguageInterface" name="EnableLanguageInterface" value="LanguageChoiceEnabled">
            <label for="EnableLanguageInterface">Check to enable language selection</label><br>
            <br>
        
        <!-- Board-->
            <h3>Board:</h3>
            Select a device:
            <br>
            <input type="radio" id="ArduinoNano" name="DeviceSetting" value="ArduinoNano" checked="checked">
            <label for="ArduinoNano">Arduino Nano</label> 
            <br>
            <input type="radio" id="ArduinoNanoESP32" name="DeviceSetting" value="ArduinoNanoESP32">
            <label for="ArduinoNanoEsp32">Arduino Nano ESP 32</label>
            <br>
            <input type="radio" id="ArduinoUno" name="DeviceSetting" value="ArduinoUno">
            <label for="ArduinoUno">Arduino Uno</label> 
            <br>
            <input type="radio" id="ArduinoMega" name="DeviceSetting" value="ArduinoMega">
            <label for="ArduinoMega">Arduino Mega</label><br>

        <!-- Controller type-->
            <h3>Controller type:</h3>
            Select a controller type:
            <br>
            <input type="radio" id="ButtonArray" name="ControlTypeSetting" value="ButtonArray" checked="checked">
            <label for="ButtonArray">Array of 5  push buttons</label> 
            <br>
            <input type="radio" id="Encoder" name="ControlTypeSetting" value="Encoder">
            <label for="Encoder">RotaryEncoder</label><br>
            <br>

        <!--Buttons to begin the generation of the arduino file:-->
            <button type="button" onclick="generateCode()">Generate Arduino Code</button>
            <br>            

        
    </form>
    
    <br>
    
    <a id="downloadLink" style="display: none" download="arduino_code.ino">Download Arduino Code</a>
    
    <script>
        
        
        //Explanations

        // explanations are given as arrays: ["English version", "Spanish version"];
            ExplanationNominalVoltage = ["This is the expected voltage of the battery when fully charged",""];
            ExplanationShutOffVoltage = ["This is the battery voltage at which the device will disconnect the load and the inverter from battery power.",""];
            ExplanationTurnBackOnVoltage = ["This is the battery voltage at which the device will reconnect the iinverter and the load if previously disconnected",""];
            ExplanationCurrentRange = ["",""];
            ExplanationOverride = ["This is the period of time the device will provide power to the inverter and the load, even with a battery voltage that is less than the set shut-off voltage if the end-user manually opts to reconnect after the load and the inverter have been disconnected by the device",""];
            ExplanationLanguage = ["This is the language that the end-user interface will appear in on the device.",""];
            ExplanationBoard = ["This is the microncontroller your low voltage disconnect is to be based upon.",""];
        
        //Generate the arduino Code
        function generateCode() {

            //Extract Variables From the Form
                //Nominal Battery Voltage JS Variable
                    const DeviceName = document.getElementById("DeviceName").value;
                    const EnableNameChange=(document.getElementById("EnableNameChange").checked);
            
                //Nominal Battery Voltage JS Variable
                    const NominalVoltage = document.getElementById("NominalVoltage").value;
                    const EnableNominalVoltageBoolean=(document.getElementById("EnableNominalVoltageInterface").checked);
                  
                //Shut off Voltage JS Variable
                    const ShutOffVoltage = document.getElementById("ShutOffVoltage").value;
                    const EnableShutOffVoltageBoolean=(document.getElementById("EnableShutOffVoltageInterface").checked);
            
            
                //Turn back on voltage JS Variables
                    const TurnBackOnVoltage = document.getElementById("TurnBackOnVoltage").value; //Turn Back on Voltage JS Variable
                    const EnableTurnBackOnVoltageBoolean=(document.getElementById("EnableTurnBackOnVoltageInterface").checked);
           
                //Current Range
                    const LowCurrent = document.getElementById("LowCurrent").value; //Low Current JS Variable

  
                //Override JS Variables
                    const OverrideDelay = document.getElementById("OverrideDelay").value; //Override Delay JS Variable
                    const EnableOverrideChange=(document.getElementById("override").checked);
           
                //Timer Offset
                    const TimerOffset = document.getElementById("TimerOffset").value; //Turn Back on Voltage JS Variable
                    const EnableTimerOffsetBoolean=(document.getElementById("EnableTimerOffsetBoolean").checked);

                //Language JS Variables
                    if(document.getElementById("english").checked==true)
                    {
                        var LanguageSetting = 1;
                    }
            
                    if(document.getElementById("spanish").checked == true)
                    {
                        var LanguageSetting = 2;
                    }
                
                    const EnableLanguageOption=(document.getElementById("EnableLanguageInterface").checked);
           
                //Device JS Variables
                    if(document.getElementById("ArduinoNano").checked==true)
                    {
                        var DeviceSelection = 1;
                    }
            
                    if(document.getElementById("ArduinoNanoESP32").checked == true)
                    {
                        var DeviceSelection = 2;
                    }
                    
                    if(document.getElementById("ArduinoUno").checked==true)
                    {
                        var DeviceSelection = 3;
                    }
            
                    if(document.getElementById("ArduinoMega").checked == true)
                    {
                        var DeviceSelection = 4;
                    }
            
                //Control Type JS Variables
                    if(document.getElementById("ButtonArray").checked == true)
                    {
                        var ControlSelection = 1;
                    }
            
                    if(document.getElementById("Encoder").checked == true)
                    {
                        var ControlSelection = 2;
                    }
                    
            
                     //Check that inputs are valid       
                                const NominalVoltageError = document.getElementById('NominalVoltageError');
                                const ShutOffVoltageError = document.getElementById('ShutOffVoltageError');

            
                                NominalVoltageError.textContent = '';
                                ShutOffVoltageError.textContent = '';

                                if (!NominalVoltage) 
                                {

                                    alert("Please enter a positive integer multiple of 12 for Nominal Voltage.");
                                }
            
                                else if (NominalVoltage % 12 !== 0) 
                                {
                                    NominalVoltageError.textContent = 'Please enter a positive integer multiple of 12 for Nominal Voltage.';
                                    alert("Nominal Voltage must be a positive integer multiple of 12.");
                                }

                                else if (isNaN(ShutOffVoltage) || ShutOffVoltage <= 0) 
                                {
                                     alert("Please enter a positive number for Shut Off VOltage (decimal values allowed");
                                }
                                
                                else if (isNaN(TurnBackOnVoltage) || TurnBackOnVoltage <= 0) 
                                {
                                     alert("Please enter a positive number for Turn Back On Voltage(decimal values allowed");
                                }
                                else if (isNaN(OverrideDelay) || TurnBackOnVoltage <= 0) 
                                {
                                     alert("Please enter a positive number for override delay (decimal values allowed");
                                }
                                else{
            
             //Set up pin assignments
                const PinData = 
                      [
                            {
                                "Name": "ArduinoNano",
                                "VoltageProbe": "19", //"Pin A0"
                                "lcdSDA": "23",//"Pin A4"
                                "lcdSCL": "24",//"Pin A5"
                                "EncoderCLK": "9",//"Pin D6"
                                "EncoderDT": "10",//"Pin D7"
                                "EncoderSW": "11",//"Pin D8"
                                "PushButton": "12",//"Pin D9"
                                "RelayOutput": "13",//"Pin10"
                                "InputUp": "2",//Pin 2
                                "InputDown": "3",//Pin 3   
                                "InputRight": "4",//Pin 4
                                "InputLeft": "5",//Pin 5     
                                "InputSelect": "6"//Pin 6
                            },   
                            {
                                "Name": "ArduinoNanoESP32",
                                "VoltageProbe": "19", //"Pin A0"
                                "lcdSDA": "23",//"Pin A4"
                                "lcdSCL": "24",//"Pin A5"
                                "EncoderCLK": "9",//"Pin D6"
                                "EncoderDT": "10",//"Pin D7"
                                "EncoderSW": "11",//"Pin D8"
                                "PushButton": "12",//"Pin D9"
                                "RelayOutput": "13",//"Pin10"
                                "InputUp": "2",//Pin 2
                                "InputDown": "3",//Pin 3   
                                "InputRight": "4",//Pin 4
                                "InputLeft": "5",//Pin 5     
                                "InputSelect": "6"//Pin 6
                            }, 
                            {
                                "Name": "ArduinoUno",
                                "VoltageProbe": "7", //"Pin A0"
                                "lcdSDA": "27",//"Pin A4"
                                "lcdSCL": "19",//"Pin A5"
                                "EncoderCLK": "3",//"Pin D3"
                                "EncoderDT": "2",//"Pin D7"
                                "EncoderSW": "6",//"Pin D6
                                "PushButton": "1",//"Pin D1"
                                "RelayOutput": "4",//"Pin D4"
                                "InputUp": "13",//Pin D13
                                "InputDown": "8",//Pin D8   
                                "InputRight": "10",//Pin 4
                                "InputLeft": "5",//Pin 5     
                                "InputSelect": "6"//Pin 6

                            },
                            {
                                "Name": "ArduinoMega",
                                "VoltageProbe": "A0", //"Pin A0"
                                "lcdSDA": "27",//"Pin A4"
                                "lcdSCL": "19",//"Pin A5"
                                "EncoderCLK": "6",//"Pin D6"
                                "EncoderDT": "7",//"Pin D7"
                                "EncoderSW": "8",//"Pin D8"
                                "PushButton": "10",//"Pin D10"
                                "RelayOutput": "2",//"Pin D2 (digital pin 2)"
                                "InputUp": "6",//Pin D2
                                "InputDown": "7",//Pin D3   
                                "InputRight": "8",//Pin D4
                                "InputLeft": "5",//Pin D5     
                                "InputSelect": "10"//Pin D6
                             }
                        ];

            // Generate Arduino code based on user input
            
                /*Start*/
                    const CodeHead =
                      `//Milligan Engineering Low Voltage Disconnect Arduino Code`
                      +
                      `\n`
                      +
                      `\n \t`
                      ;
            
                /*Libraries*/     
                    const LibrariesSectionEncoder =
                      `//Specify Libraries for a device with an encoder`
                      +
                      `\n \t`
                      +
                      `#include <EEPROM.h> //This library is necesary for memory management`
                      +
                      `\n \t`
                      +
                      `#include <LiquidCrystal_I2C.h> //This library is necesary for LCD display management`
                      +
                      `\n \t`
                      +
                      `#include <Encoder.h> //This library is necesary for using rotary encoders as inputs`
                      +
                      `\n \t`
                      +
                      `LiquidCrystal_I2C lcd(0x27,20,4);  // set the LCD address to 0x27 for a 20 chars and 4 line display`
                      +
                      `\n \t`
                      +
                      `const int EEPROM_ADDR = 0; // EEPROM address to store the user input`
                      +
                      `\n \t`
                      +
                      `const int MAX_INPUT_LENGTH = 32; // Maximum length of user input`
                      +
                      `\n \t`
                      +
                      `char userInput[MAX_INPUT_LENGTH] = {0}; // Buffer to store user input`
                      +
                      `\n \n`
                      ;
                                    
                /*Libraries for device with button array*/     
                    const LibrariesSectionButtonArray =
                      `//Specify Libraries for a device with an array of 5 buttons for control input`
                      +
                      `\n \t`
                      +
                      `#include <EEPROM.h> //This library is necesary for memory management`
                      +
                      `\n \t`
                      +
                      `#include <LiquidCrystal_I2C.h> //This library is necesary for LCD display management`
                      +
                      `\n \t`
                      +
                      `\n \t`
                      +
                      `LiquidCrystal_I2C lcd(0x27,20,4);  // set the LCD address to 0x27 for a 20 chars and 4 line display`
                      +
                      `\n \t`
                      +
                      `const int EEPROM_ADDR = 0; // EEPROM address to store the user input`
                      +
                      `\n \t`
                      +
                      `const int MAX_INPUT_LENGTH = 32; // Maximum length of user input`
                      +
                      `\n \t`
                      +
                      `char userInput[MAX_INPUT_LENGTH] = {0}; // Buffer to store user input`
                      +
                      `\n \n`
                      ;
            
                /*LCD Related*/
                      const LiquidCrystalDisplayVariablesSection =
                      `//Liquid crystal display related variables`
                      +
                      `\n \n`
                      +
                      `int scrollPosition = 0;     //First Line`
                      +
                      `\n \n`
                      +
                      `bool selectPressed = false; // Select button latch`
                      +
                      `\n \n`
                      ;       
                const VoltageProbeSpecifications =
/*Voltage Probe Related*/`//Voltage Probe related variables`
                      +
                      `\n \t`
                      +
                      `const float Resistor1 = 1.35e6; //ohms`
                      +
                      `\n \t`
                      +
                      `const float Resistor2 = 750e3; //ohms`
                      +
                      `\n \n`
                      ;
/*Customer-set Variables*/const GlobalVariables =
                      `//Global Variables:`
                      +
                      `\n \t`
                      +
                      `String DeviceName = "${DeviceName}";`
                      +
                      `\n \t`
                      +
                      `bool EnableNameChange = ${EnableNameChange};`
                      +
                      `\n \t`
                      +
                      `float NominalVoltage = ${NominalVoltage};`
                      +
                      `\n \t`
                      +
                      `bool EnableNominalVoltageInterface = ${EnableNominalVoltageBoolean};`
                      +
                      `\n \t`
                      +
                      `float ShutOffVoltage = ${ShutOffVoltage};`
                      +
                      `\n \t`
                      +
                      `bool EnableShutOffVoltageBoolean = ${EnableShutOffVoltageBoolean};`
                      +
                      `\n \t`
                      +
                      `float TurnBackOnVoltage = ${TurnBackOnVoltage};`
                      +
                      `\n \t`
                      +
                      `bool EnableTurnBackOnVoltageInterface = ${EnableTurnBackOnVoltageBoolean};`
                      +
                      `\n \t`
                      +                      
                      `\n \t`
                      +
                      `unsigned long OverrideDelay = ${OverrideDelay}*60000; //milliseconds`
                      +                      
                      `\n \t`
                      +
                      `bool EnableOverrideChange = ${EnableOverrideChange};`
                      +
                      `\n \t`
                      +
                      `bool EnableTimerOffsetBoolean = ${EnableTimerOffsetBoolean};`
                      +
                      `\n \t`
                      +
                      `unsigned long TimerOffset = ${TimerOffset}*1000; //milliseconds`
                      +
                      `\n \t`
                      +
                      `int TimeDelay = 30000; //Delay for turning back on or off`
                      +
                      `\n \t`
                      +
                      `int LanguageSetting = ${LanguageSetting};`
                      +
                      `\n \t`
                      +
                      `bool EnableLanguageInterface = ${EnableLanguageOption};`
                      +
                      `\n \t`
                      +
                      `int DeviceSetting = ${DeviceSelection};`
                      +
                      `\n \n \t`
                      ;
            
/*Timer Related*/ const TimerRelatedVariables =
                      `//Timer-related variables`
                      +
                      `\n \t`
                      +
                      `unsigned long previousMillis = 0;`
                      +
                      `\n \t`
                      +
                      `unsigned long RolloverTime = (pow(2,32)-1);// Set an interval in milliseconds to ensure that millis() rollover (happens once approximately every 50 days when millis() resets to zero) is never an issue for more than 10 minutes`
                      +
                      `\n \n`
                      +
                      `const int DisconnectBufferTime = 30000;  // Number of seconds to add to Disconnect timer (minimum value)`
                      +
                      `\n \n`
                      ;
/*Pin Assignments*/const GetPinAssignments =
                      `//Get Pin Assignments:`
                      +
                      `\n \t`
                      +
                     `int VoltageProbe= ${PinData[DeviceSelection-1].VoltageProbe};`
                      +
                      `\n \t`
                      +
                      `int lcdSDA= ${PinData[DeviceSelection-1].lcdSDA};`
                      +
                      `\n \t`
                      +
                      `int lcdSCL= ${PinData[DeviceSelection-1].lcdSCL};`
                      +
                      `\n \t`
                      +
                      `int EncoderCLK = ${PinData[DeviceSelection-1].EncoderCLK};`
                      +
                      `\n \t`
                      +
                      `int EncoderDT = ${PinData[DeviceSelection-1].EncoderDT};`
                      +
                      `\n \t`
                      +
                      `int EncoderSW = ${PinData[DeviceSelection-1].EncoderSW};`
                      +
                      `\n \t`
                      +
                      `int PushButton = ${PinData[DeviceSelection-1].PushButton};`
                      +
                      `\n \t`
                      +
                      `int RelayOutput = ${PinData[DeviceSelection-1].RelayOutput};`
                      +
                      `\n \t`
                      +
                      `int InputUp = ${PinData[DeviceSelection-1].InputUp};`
                      +
                      `\n \t`
                      +
                      `int InputDown = ${PinData[DeviceSelection-1].InputDown};`
                      +
                      `\n \t`
                      +
                      `int InputRight = ${PinData[DeviceSelection-1].InputRight};`
                      +
                      `\n \t`
                      +
                      `int InputLeft = ${PinData[DeviceSelection-1].InputLeft};`
                      +
                      `\n \t`
                      +             
                      `int InputSelect = ${PinData[DeviceSelection-1].InputSelect};`
                      +
                      `\n `
                      ;                                

/*Screen Case Statements*/const EncoderSetup =
                       `//Encoder`
                       +
                       `\n \t`
                       +
                       `Encoder myEncoder(2, 3); // Connect encoder pins (Clk,DT)`
                       +
                       `\n \t`
                       +
                       `long oldPosition  = -999;`
                       +
                       `\n \t`
                       +
                       `int EncoderDirection = 0;                 //Idle by default`
                       +
                       `\n \t`
                       +
                       `const int scrollThreshold = 4;    //Update this value based on the desired sensitivty of your encoder`
                       +
                       `\n \t`
                       +
                       `int ChangeInPosition = 0;`
                       ;
                                    
/*Screen Case Statements*/const LCDScreenCaseStatements =
                      `//All Possible Screens`
                      +
                      `\n \t`
                      +
                      `void Screens(int scrollPosition)`
                      +
                      `\n \t`
                      +
                      `{`
                      +
                      `\n \t \t`
                      +
                      `switch(scrollPosition)`
                      +
                      `\n \t \t`
                      +
                      `{`
                      +
                      `\n \t \t \t`
                      +
                      `case 0:`/* Case 0 Starts Here*/
                      +
                      `\n \t \t \t`
                      +
                      `{`
                      +
                      `\n \t \t \t \t`
                      +
                      `lcd.setCursor(0,0);`
                      +
                      `\n \t \t \t \t`
                      +
                      `lcd.print(">Batt. V        ");`
                      +
                      `\n \t \t \t \t`
                      +
                      `lcd.print(NominalVoltage,1);`
                      +
                      `\n \t \t \t \t`
                      +
                      `lcd.setCursor(0,1);`
                      +
                      `\n \t \t \t \t`
                      +
                      `lcd.print(" CutOff V       ");`
                      +
                      `\n \t \t \t \t`
                      +
                      `lcd.print(ShutOffVoltage,1);`
                      +
                      `\n \t \t \t \t`
                      +
                      `lcd.setCursor(0,2);`
                      +
                      `\n \t \t \t \t`
                      +
                      `lcd.print(" CutOn V        ");`
                      +
                      `\n \t \t \t \t`
                      +
                      `lcd.print(TurnBackOnVoltage,1);`
                      +
                      `\n \t \t \t \t`
                      +
                      `lcd.setCursor(0,3);`
                      +
                      `\n \t \t \t \t`
                      +
                      `lcd.print(" Override T:   ");`
                      +
                      `\n \t \t \t \t`
                      +
                      `lcd.print(OverrideDelay/60000);`
                      +
                      `\n \t \t \t \t`
                      +
                      `lcd.print("min");`
                      +
                      `\n \t \t \t \t`
                      +
                      `break;`
                      +
                      `\n \t \t \t`
                      +
                      `}`                   
                      +
                      `\n \t \t \t`
                      +
                      `case 1:`
                      +
                      `\n \t \t \t`
                      +
                      `{`/* Case 1 Starts Here*/
                      +
                      `\n \t \t \t \t`
                      +
                      `lcd.setCursor(0,0);`
                      +
                      `\n \t \t \t \t`
                      +
                      `lcd.print(" Batt. V        ");`
                      +
                      `\n \t \t \t \t`
                      +
                      `lcd.print(NominalVoltage,1);`
                      +
                      `\n \t \t \t \t`
                      +
                      `lcd.setCursor(0,1);`
                      +
                      `\n \t \t \t \t`
                      +
                      `lcd.print(">CutOff V       ");`
                      +
                      `\n \t \t \t \t`
                      +
                      `lcd.print(ShutOffVoltage,1);`
                      +
                      `\n \t \t \t \t`
                      +
                      `lcd.setCursor(0,2);`
                      +
                      `\n \t \t \t \t`
                      +
                      `lcd.print(" CutOn V        ");`
                      +
                      `\n \t \t \t \t`
                      +
                      `lcd.print(TurnBackOnVoltage,1);`
                      +
                      `\n \t \t \t \t`
                      +
                      `lcd.setCursor(0,3);`
                      +
                      `\n \t \t \t \t`
                      +
                      `lcd.print(" Override T:   ");`
                      +
                      `\n \t \t \t \t`
                      +
                      `lcd.print(OverrideDelay/60000);`
                      +
                      `\n \t \t \t \t`
                      +
                      `lcd.print("min");`
                      +
                      `\n \t \t \t \t`
                      +
                      `break;`
                      +
                      `\n \t \t \t`
                      +
                      `}`
                      +
                      `\n \t \t \t`
                      +
                      `case 2:`
                      +
                      `\n \t \t \t`
                      +
                      `{`/* Case 2 Starts Here*/
                      +
                      `\n \t \t \t \t`
                      +
                      `lcd.setCursor(0,0);`
                      +
                      `\n \t \t \t \t`
                      +
                      `lcd.print(" Batt. V        ");`
                      +
                      `\n \t \t \t \t`
                      +
                      `lcd.print(NominalVoltage,1);`
                      +
                      `\n \t \t \t \t`
                      +
                      `lcd.setCursor(0,1);`
                      +
                      `\n \t \t \t \t`
                      +
                      `lcd.print(" CutOff V       ");`
                      +
                      `\n \t \t \t \t`
                      +
                      `lcd.print(ShutOffVoltage,1);`
                      +
                      `\n \t \t \t \t`
                      +
                      `lcd.setCursor(0,2);`
                      +
                      `\n \t \t \t \t`
                      +
                      `lcd.print(">CutOn V        ");`
                      +
                      `\n \t \t \t \t`
                      +
                      `lcd.print(TurnBackOnVoltage,1);`
                      +
                      `\n \t \t \t \t`
                      +
                      `lcd.setCursor(0,3);`
                      +
                      `\n \t \t \t \t`
                      +
                      `lcd.print(" Override T:   ");`
                      +
                      `\n \t \t \t \t`
                      +
                      `lcd.print(OverrideDelay/60000);`
                      +
                      `\n \t \t \t \t`
                      +
                      `lcd.print("min");`
                      +
                      `\n \t \t \t \t`
                      +
                      `break;`
                      +
                      `\n \t \t \t`
                      +
                      `}`
                      +
                      `\n \t \t \t`
                      +
                      `case 3:`
                      +
                      `\n \t \t \t`
                      +
                      `{`/* Case 3 Starts Here*/
                      +
                      `\n \t \t \t \t`
                      +
                      `lcd.setCursor(0,0);`
                      +
                      `\n \t \t \t \t`
                      +
                      `lcd.print(" Batt. V        ");`
                      +
                      `\n \t \t \t \t`
                      +
                      `lcd.print(NominalVoltage,1);`
                      +
                      `\n \t \t \t \t`
                      +
                      `lcd.setCursor(0,1);`
                      +
                      `\n \t \t \t \t`
                      +
                      `lcd.print(" CutOff V       ");`
                      +
                      `\n \t \t \t \t`
                      +
                      `lcd.print(ShutOffVoltage,1);`
                      +
                      `\n \t \t \t \t`
                      +
                      `lcd.setCursor(0,2);`
                      +
                      `\n \t \t \t \t`
                      +
                      `lcd.print(" CutOn V        ");`
                      +
                      `\n \t \t \t \t`
                      +
                      `lcd.print(TurnBackOnVoltage,1);`
                      +
                      `\n \t \t \t \t`
                      +
                      `lcd.setCursor(0,3);`
                      +
                      `\n \t \t \t \t`
                      +
                      `lcd.print(">Override T:   ");`
                      +
                      `\n \t \t \t \t`
                      +
                      `lcd.print(OverrideDelay/60000);`
                      +
                      `\n \t \t \t \t`
                      +
                      `lcd.print("min");`
                      +
                      `\n \t \t \t \t`
                      +
                      `break;`
                      +
                      `\n \t \t \t`
                      +
                      `} //end of case 3`
                      +
                      `\n \t \t`
                      +
                      `} // end of switch`
                      +
                      `\n \t`
                      +
                      `}//End of Screens()`
                      +
                      `\n \t`
                      +      
                      `//lcd.print(" ") then next line print the arrow`
                      +
                      `\n \t`
                      +
                      `//Allows ">" character to change lines`
                      +
                      `\n \t`
                      ;
    /*Void Scroll*/   const ButtonScrollFunction =
                      `void Scroll()`
                      +
                      `\n \t`
                      +
                      `{`
                      +
                      `\n \t \t`
                      +
                      `int UP_State = digitalRead(InputUp);`
                       +
                       `\n \t \t`
                       +
                       `int Down_State = digitalRead(InputDown);`
                       +
                       `\n \t \t`
                       +
                       `if (UP_State == HIGH && scrollPosition>0)`
                       +
                       `\n \t \t`
                       +
                       `{`
                       +
                       `\n \t \t \t`
                       +
                       `scrollPosition--;`
                       +
                       `\n \t \t`
                       +
                       `} //End of ButtonScroll()`
                       +
                       `\n \t \t`
                       +
                       `if (Down_State == HIGH && scrollPosition<3)`
                       +
                       `\n \t \t`
                       +
                       `{`
                       +
                       `\n \t \t \t`
                       +
                       `scrollPosition++;`
                       +
                       `\n \t \t`
                       +
                       `} // end of if(Down_State == HIGH && scrollPosition<3) `
                       +
                       `\n \t \t`
                       +
                       `//Might need to add to where it doesn't change multiple lines on holding buttons.`
                       +
                       `\n \t \t`
                       +
                       `Screens(scrollPosition);`
                       +
                       `\n \t`
                       +
                       `} // end void Scroll()`
                       + 
                       `\n \t`
                       ;
                                    
/*Void EncoderScroll*/ const EncoderScrollFunction =
                       `// Scroll function for a devicew with a rotary encoder control input:`
                       +
                       `\n \t`
                       +
                       `void Scroll()`
                       +
                       `\n \t`
                       +
                       `{`
                       +
                       `\n \t \t`
                       +
                       `long newPosition = myEncoder.read();`
                       +
                       `\n \t \t`
                       +
                       `if (newPosition != oldPosition)`
                       +
                       `\n \t \t`
                       +
                       `{`
                       +
                       `\n \t \t \t`
                       +
                       `//ChangeInPosition = ChangeInPosition % scrollThreshold;  //Not needed if ChangeInPosition reset`
                       +
                       `\n \t \t \t`
                       +
                       `ChangeInPosition++;`
                       +
                       `\n \t \t \t`
                       +
                       `if (newPosition > oldPosition)`
                       +
                       `{`
                       +
                       `\n \t \t \t \t`
                       +
                       `EncoderDirection = 1;`
                       +
                       `\n \t \t \t \t`
                       +
                       `} // end if (newPosition > oldPosition)`
                       +
                       `\n \t \t \t`
                       +
                       `else if (newPosition < oldPosition)`
                       +
                       `\n \t \t \t \t`
                       +
                       `{`
                       +
                       `\n \t \t \t \t \t`
                       +
                       `EncoderDirection = 2;`
                       +
                       `\n \t \t \t \t`
                       +
                       `} //end else if (newPosition < oldPosition)`
                       +
                       `\n \t \t \t`
                       +
                       `else`
                       +
                       `\n \t \t \t`
                       +
                       `{`
                       +
                       `\n \t \t \t \t`
                       +
                       `EncoderDirection = 0;  //Idle`
                       +
                       `\n \t \t \t`
                       +
                       `}`
                       +
                       `\n \t \t \t`
                       +
                       `if (scrollPosition < 3)`
                       +
                       `\n \t \t \t`
                       +
                       `{`
                       +
                       `\n \t \t \t \t`
                       +
                       `if (EncoderDirection == 2 && abs(ChangeInPosition >= scrollThreshold))`
                       +
                       `\n \t \t \t \t`
                       +
                       `{`
                       +
                       `\n \t \t \t \t \t`
                       +
                       `scrollPosition++;`
                       +
                       `\n \t \t \t \t \t`
                       +
                       `ChangeInPosition = 0;  // Reset ChangeInPosition, prevent overflow issues`
                       +
                       `\n \t \t \t \t \t`
                       +
                       `} //end if (EncoderDirection == 2 && abs(ChangeInPosition >= scrollThreshold))`
                       +
                       `\n \t`
                       +
                       `}`
                       +
                       `\n \t`
                       +
                       `if (scrollPosition > 0)`
                       +
                       `\n \t`
                       +
                       `{`
                       +
                       `\n \t`
                       +
                       `if (EncoderDirection == 1 && abs(ChangeInPosition >= scrollThreshold))`
                       +
                       `{`
                       +
                       `\n \t`
                       +
                       `scrollPosition--;`
                       +
                       `\n \t`
                       +
                       `ChangeInPosition = 0;  // Reset ChangeInPosition, prevent overflow issues`
                       +
                       `\n \t`
                       +
                       `}`
                       +
                       `\n \t`
                       +
                       `}`
                       +
                       `\n \t`
                       +
                       `oldPosition = newPosition;    //Update oldPosition for next iteration`
                       +
                       `\n \t`
                       +
                       `}`
                       +
                       `\n \t`
                       +
                       `} //end Scroll() function`
                       +
                       `\n \t`
                       ;            
                                    
                                    
/*Void Select*/const ButtonSelectFunction =
                   `void Select()`
                   +
                   `\n \t`
                   +
                   `{`
                   +
                   `\n \t \t`
                   +
                   `int RIGHT_State = digitalRead(InputRight);`
                   +
                   `\n \t \t`
                   +
                   `int LEFT_State = digitalRead(InputLeft);`
                   +
                   `\n \t \t`
                   +
                   `\n \t \t`
                   +
                   `if (scrollPosition == 1)`
                   +
                   `\n \t \t`
                   +
                   `{`
                   +
                   `\n \t \t \t`
                   +
                   `Screens(scrollPosition);    // Keep updating the screen`
                   +
                   `\n \t \t \t`
                   +
                   `if ((RIGHT_State == HIGH)&&(EnableShutOffVoltageBoolean == true))`
                   +
                   `\n \t \t \t`
                   +
                   `{`
                   +
                   `\n \t \t \t \t`
                   +
                   `ShutOffVoltage = ShutOffVoltage + 0.1;`
                   +
                   `\n \t \t \t`
                   +
                   `} //end if((RIGHT_State == HIGH)&&(EnableShutOffVoltageBoolean == true))`
                   +
                   `\n \t \t \t`
                   +
                   `if ((LEFT_State == HIGH)&&(EnableShutOffVoltageBoolean == true))`
                   +
                   `\n \t \t \t`
                   +
                   `{`
                   +
                   `\n \t \t \t \t`
                   +
                   `ShutOffVoltage = ShutOffVoltage - 0.1;`
                   +
                   `\n \t \t \t`
                   +
                   `} // end if((LEFT_State == HIGH)&&(EnableShutOffVoltageBoolean == true))`
                   +
                   `\n \t \t`
                   +
                   `} //end (if ScrollPosition==1)`
                   +  
                   `\n \t \t`
                   +
                   `else if (scrollPosition == 2)`
                   +  
                   `\n \t \t`
                   +
                   `{`
                   +
                   `\n \t \t \t`
                   +
                   `Screens(scrollPosition);`
                   +
                   `\n \t \t \t`
                   +
                   `if ((RIGHT_State == HIGH)&&(EnableTurnBackOnVoltageInterface == true))`
                   +
                   `\n \t \t \t`
                   +
                   `{`
                   +
                   `\n \t \t \t \t`
                   +
                   `TurnBackOnVoltage = TurnBackOnVoltage + 0.1;`
                   +
                   `\n \t \t \t`
                   +
                   `} //if ((RIGHT_State == HIGH)&&(EnableTurnBackOnVoltageInterface == true))`
                   +
                   `\n \t \t \t`
                   +
                   `if ((LEFT_State == HIGH)&&(EnableTurnBackOnVoltageInterface == true))`
                   +  
                   `\n \t \t \t`
                   +
                   `{`
                   +
                   `\n \t \t \t \t`
                   +
                   `TurnBackOnVoltage = TurnBackOnVoltage - 0.1;`
                   +
                   `\n \t \t \t`
                   +
                   `} //end of  if((LEFT_State == HIGH)&&(EnableTurnBackOnVoltageInterface == true))`
                   +
                   `\n \t \t`
                   +
                   `} //end of else if (scrollPosition == 2)`
                   +
                   `\n \t \t`
                   +
                   `else if (scrollPosition == 3)`
                   +
                   `\n \t \t`
                   +
                   `{`
                   +
                   `\n \t \t \t`
                   +
                   `Screens(scrollPosition);`
                   +
                   `\n \t \t \t`
                   +
                   `if ((RIGHT_State == HIGH)&&(EnableOverrideChange == true))`
                   +
                   `\n \t \t \t`
                   +
                   `{`
                   +
                   `\n \t \t \t \t`
                   +
                   `OverrideDelay = OverrideDelay + (5*60000);`
                   +
                   `\n \t \t \t`
                   +
                   `} //end if ((RIGHT_State == HIGH)&&(EnableOverrideChange == true))`
                   +
                   `\n \t \t \t`
                   +
                   `if ((LEFT_State == HIGH)&&(EnableOverrideChange == true))`
                   +
                   `\n \t \t \t`
                   +
                   `{`
                   +
                   `\n \t \t \t \t`
                   +
                   `OverrideDelay = OverrideDelay - (5*60000);`
                   +
                   `\n \t \t \t`
                   +
                   `} //end of if ((LEFT_State == HIGH)&&(EnableOverrideChange == true))`
                   +
                   `\n \t \t`
                   +
                   `}   //end of else if (scrollPosition == 3)`
                   +
                   `\n \t`
                   +
                   `} //end void Select()` 
                   +
                   `\n \t`
                   ;
                                    
/*Void Encoder Select*/const EncoderSelectFunction =
                   `void Select()`
                   +
                   `\n \t`
                   +
                   `{`
                   +
                   `\n \t`
                   +
                   `long newPosition = myEncoder.read();`
                   +
                   `\n \t`
                   +
                   `if (newPosition != oldPosition)`
                   +
                   `{`
                   +
                   `\n \t`
                   +
                   `//ChangeInPosition = ChangeInPosition % scrollThreshold;  //Not needed if ChangeInPosition reset`
                   +
                   `\n \t`
                   +
                   `ChangeInPosition++;`
                   +
                   `\n \t`
                   +
                   `if (newPosition > oldPosition)`
                   +
                   `\n \t`
                   +
                   `{`
                   +
                   `\n \t`
                   +
                   `EncoderDirection = 1;`
                   +
                   `\n \t`
                   +
                   `}`
                   +
                   `\n \t`
                   +
                   `else if (newPosition < oldPosition)`
                   +
                   `{`
                   +
                   `\n \t`
                   +
                   `EncoderDirection = 2;`
                   +
                   `\n \t`
                   +
                   `}`
                   +
                   `\n \t`
                   +
                   `else`
                   +
                   `\n \t`
                   +
                   `{`
                   +
                   `\n \t`
                   +
                   `EncoderDirection = 0;  //Idle`
                   +
                   `\n \t`
                   +
                   `}`
                   +
                   `\n \t`
                   +
                   `if (scrollPosition == 0)`
                   +
                   `\n \t`
                   +
                   `{`
                   +
                   `\n \t`
                   +
                   `Screens(scrollPosition);    // Keep updating the screen`
                   +
                   `\n \t`
                   +
                   `if (EncoderDirection == 2 && abs(ChangeInPosition >= scrollThreshold))`
                   +
                   `\n \t`
                   +
                   `{`
                   +
                   `\n \t`
                   +
                   `if (NominalVoltage < 48.0)`
                   +
                   `\n \t`
                   +
                   `{`
                   +
                   `\n \t`
                   +
                   `NominalVoltage = NominalVoltage + 12;`
                   +
                   `\n \t`
                   +
                   `}`
                   +
                   `\n \t`
                   +
                   `} //end if(RIGHT_State == HIGH)`
                   +
                   `\n \t`
                   +
                   `if (EncoderDirection == 1 && abs(ChangeInPosition >= scrollThreshold))`
                   +
                   `\n \t`
                   +
                   `{`
                   +
                   `\n \t`
                   +
                   `if (NominalVoltage > 12)`
                   +
                   `{`
                   +
                   `\n \t`
                   +
                   `NominalVoltage = NominalVoltage - 12;`
                   +
                   `\n \t`
                   +
                   `}`
                   +
                   `\n \t`
                   +
                   `}`
                   +
                   `\n \t`
                   +
                   `}`
                   +
                   `\n \t`
                   +
                   `else if (scrollPosition == 1)`
                   +
                   `\n \t`
                   +
                   `{`
                   +
                   `\n \t`
                   +
                   `Screens(scrollPosition);`
                   +
                   `\n \t`
                   +
                   `if (EncoderDirection == 2 && abs(ChangeInPosition >= scrollThreshold)) //clockwise`
                   +
                   `\n \t`
                   +
                   `{`
                   +
                   `\n \t`
                   +
                   `ShutOffVoltage = ShutOffVoltage + 0.1;`
                   +
                   `\n \t`
                   +
                   `} //end if(RIGHT_State == HIGH)`
                   +
                   `\n \t`
                   +
                   `if (EncoderDirection == 1 && abs(ChangeInPosition >= scrollThreshold))`
                   +
                   `\n \t`
                   +
                   `{`
                   +
                   `\n \t`
                   +
                   `ShutOffVoltage = ShutOffVoltage - 0.1;`
                   +
                   `\n \t`
                   +
                   `} // end if(LEFT_State == HIGH)`
                   +
                   `\n \t`
                   +
                   `} //end (if ScrollPosition==1)`
                   +
                   `\n \t`
                   +
                   `else if (scrollPosition == 2)`
                   +
                   `\n \t`
                   +
                   `{`
                   +
                   `\n \t`
                   +
                   `Screens(scrollPosition);`
                   +
                   `\n \t`
                   +
                   `if (EncoderDirection == 2 && abs(ChangeInPosition >= scrollThreshold))`
                   +
                   `\n \t`
                   +
                   `{`
                   +
                   `\n \t`
                   +
                   `TurnBackOnVoltage = TurnBackOnVoltage + 0.1;`
                   +
                   `\n \t`
                   +
                   `} //if (RIGHT_State == HIGH)`
                   +
                   `\n \t`
                   +
                   `if (EncoderDirection == 1 && abs(ChangeInPosition >= scrollThreshold))`
                   +
                   `\n \t`
                   +
                   `{`
                   +
                   `\n \t`
                   +
                   `TurnBackOnVoltage = TurnBackOnVoltage - 0.1;`
                   +
                   `\n \t`
                   +
                   `} //end of  if(LEFT_State == HIGH)`
                   +
                   `\n \t`
                   +
                   `} //end of else if (scrollPosition == 2)`
                   +
                   `\n \t`
                   +
                   `else if (scrollPosition == 3)`
                   +
                   `\n \t`
                   +
                   `{`
                   +
                   `\n \t`
                   +
                   `Screens(scrollPosition);`
                   +
                   `\n \t`
                   +
                   `if (EncoderDirection == 2 && abs(ChangeInPosition >= scrollThreshold))`
                   +
                   `\n \t`
                   +
                   `{`
                   +
                   `\n \t`
                   +
                   `OverrideDelay = OverrideDelay + (5*60000);`
                   +
                   `\n \t`
                   +
                   `}`
                   +
                   `\n \t`
                   +
                   `if (EncoderDirection == 1 && abs(ChangeInPosition >= scrollThreshold) && (OverrideDelay > 0))`
                   +
                   `\n \t`
                   +
                   `{`
                   +
                   `\n \t`
                   +
                   `OverrideDelay = OverrideDelay - (5*60000);`
                   +
                   `\n \t`
                   +
                   `} //end of if (LEFT_State == HIGH)`
                   +
                   `\n \t`
                   +
                   `}`
                   +
                   `\n \t`
                   +
                   `oldPosition = newPosition;    //Update oldPosition for next iteration`
                   +
                   `\n \t`
                   +
                   `}`
                   +
                   `\n \t`
                   +
                   `}`
                   ;
                                    
/*Void Read User Input*/const ReadUserInputMemoryFunction =
                   `void readUserInput()`
                   +
                   `\n`
                   +
                   `{`
                   +
                   `\n \t`
                   +
                   `// Read user input from EEPROM and load it into the userInput buffer`
                   +
                   `\n \t`
                   +
                   `for (int i = 0; i < MAX_INPUT_LENGTH; i++)`
                   +
                   `{`
                   +
                   `\n \t \t`
                   +
                   `char c = EEPROM.read(EEPROM_ADDR + i);`
                   +
                   `\n \t \t`
                   +
                   `if (c ==`
                   +
                   String.raw`'\0'`
                   +
                   `)`
                   +
                   `\n \t \t`
                   +
                  `{`
                  +
                  `\n \t \t \t`
                  +
                  `break; // End of stored data`
                  +
                  `\n \t \t`
                  +
                  `} //End of if statement`
                  +
                  `\n \t \t`
                  +
                  `userInput[i] = c;`
                  +
                  `\n \t`
                  +
                  `}//end of for loop`
                  +
                  `\n`
                  +
                  `} //end of Read User Input`
                  +
                  `\n \n`
                  ;
/*Void Write User Input*/const WriteUserInputMemoryFunction =
                  `void writeUserInput()`
                  +
                  `\n`
                  +
                  `{`
                  +
                  `\n \t`
                  +
                  `// Write user input from the userInput buffer to EEPROM`
                  +
                  `\n \t`
                  +
                  `for (int i = 0; i < MAX_INPUT_LENGTH; i++)`
                  +
                  `\n \t`
                  +
                  `{`
                  +
                  `\n \t \t`
                  +
                  `if (userInput[i] == `
                  +
                  String.raw`'\0'`
                  +
                  `)`
                  +
                  `\n \t \t`
                  +
                  `{`
                  +
                  `\n \t \t \t`
                  +
                  `break; // End of input`
                  +
                  `\n \t \t`
                  +
                  `} //end of if statment`
                  +
                  `\n \t`
                  +
                  `EEPROM.write(EEPROM_ADDR + i, userInput[i]);`
                  +
                  `\n \t`
                  +
                  `} //end of for loop`
                  +
                  `\n \t`
                  +
                  `EEPROM.write(EEPROM_ADDR + MAX_INPUT_LENGTH, `
                  +
                  String.raw`'\0'`
                  +
                  `); // Null-terminate the string`
                  +
                  `\n`
                  +
                  `} //end of writeUserInput`
                  +
                  `\n`
                  +
                  `\n \n`
                  ;
/*TimeSinceBoot*/const TimeSinceBootFunction =
                  `//Find the time since the Low Voltage Disconnect was turned on`
                  +
                  `\n \t`
                  +
                  `unsigned long TimeSinceBoot()`
                  +
                  `\n \t`
                  +
                  `{`
                  +
                  `\n \t`
                  +
                  `unsigned long SystemTime = millis()+TimerOffset; // TimerOffset allows manipulating timers for testing purposes (you can start the timer at a much later time than the actual time since starting)`
                  +
                  `\n \t`
                  +
                  `Serial.print(DeviceName +"System Time: ");`
                  +
                  `\n \t`
                  +
                  `Serial.print(SystemTime/1000);`
                  +
                  `\n \t`
                  +
                  `Serial.print(DeviceName +" seconds");`
                  +
                  `\n \t`
                  +
                  `Serial.print(`
                  +
                  String.raw`'\n'`
                  +
                  `);`
                  +
                  `\n \t`
                  +
                  `return(SystemTime);`
                  +
                  `\n \t`
                  +
                  `} //end of TimeSinceBoot() function`
                  ;
/*Start Timer Function*/const StartTimerFunction =
                  `//SetTimerEnd`
                  +
                  `\n`
                  +
                  `unsigned long SetTimerEnd()`
                  +
                  `\n \t`
                  +
                   `{`
                  +
                  `\n \t \t`
                  +
                  `unsigned long ShutOffTime;`
                  +
                  `\n \t \t`
                  +
                   `if(TimeSinceBoot()>=RolloverTime-OverrideDelay)`
                  +
                  `\n \t \t`
                  +
                  `{`
                  +
                  `\n \t \t \t`
                  +
                  `ShutOffTime = (TimeSinceBoot()+OverrideDelay)-RolloverTime;`
                  +
                  `\n \t \t \t`
                  +  
                  `\n \t \t \t`
                  +
                  `\n \t \t`
                  +
                   `} //end of if statement`
                  +
                  `\n \t \t`                  
                  +
                  `else // "normal operation", when TimeSinceBoot() is not within the Override Delay's duration of the millis() rollover`
                  +
                  `\n \t \t`
                  +
                  `{`
                  +
                  `\n \t \t \t`
                  +
                  `ShutOffTime = TimeSinceBoot()+OverrideDelay;`
                  +                  
                  `\n \t \t`
                  +
                  `} //end of else statement`
                  +
                  `\n \t`
                  +
                  `return(ShutOffTime);`
                  +
                  `\n`
                  +
                   `} //end of SetTimerEnd() function`
                  +
                  `\n \n`
                  ;
/*Voltage Measurement*/const VoltageMeasurementFunction =
                  `float MeasureVoltage()`
                  +
                  `\n`
                  +
                  `{`
                  +
                  `\n \t`
                  +
                  `float VoltageMeasurement= analogRead(VoltageProbe)*5/1023; //The ratio is 5 Volts (max voltage that can go into a pin)/ 1023 (AnalogRead() measures between 0 and 1023`
                  +
                  `\n \t`
                  +
                  `float BatteryVoltage = VoltageMeasurement*(Resistor1+Resistor2)/(Resistor2); //This uses voltage divider math to caclulate the battery voltage.`
                  +
                  `\n \t`
                  +
                  `Serial.print(DeviceName +"Voltage measured at probe = ");`
                  +
                  `\n \t`
                  +
                   `Serial.print(VoltageMeasurement);`
                  +
                  `\n \t`
                  +
                  `\n \t`
                  +
                  `Serial.print(`
                  +
                  String.raw`'\n'`
                  +
                  `);`
                  +
                  `\n \t`
                  +
                  `Serial.print(DeviceName +"Battery Voltage = ");` 
                  +
                  `\n \t`
                  +
                  `Serial.print(BatteryVoltage);`
                  +
                  `\n \t`
                  +
                  `Serial.print(`
                  +
                  String.raw`'\n'`
                  +
                  `);`
                  +
                  `\n \t`
                  +
                  `return(BatteryVoltage);`
                  +
                  `\n`
                  +
                  `} //end of function, MeasureVoltage()`
                  +
                  `\n \n`
                  ;
/*Turn off output*/const TurnOffOutputFunction =
                  `void TurnOffOutput()`
                  +
                  `\n`
                  +
                  `{`
                  +
                  `\n \t`
                  +
                  `digitalWrite(RelayOutput, LOW);  // sets the relay output off`
                  +
                  `\n \t`
                  +
                  `Serial.print(DeviceName +"Output disconnected.");`
                  +
                  `\n`
                  +
                  `} //end of function, TurnOffOutput()`
                  +
                  `\n`
                  ;
/*Turn on output*/const TurnOnOutputFunction =
                  `void TurnOnOutput() `
                  +
                  `\n`
                  +
                  `{`
                  +
                  `\n \t`
                  +
                  `digitalWrite(RelayOutput, HIGH);  // sets the relay output on`
                  +
                  `\n \t`
                  +
                  `Serial.print(DeviceName +"Output connected.");`
                  +
                  `\n`
                  +
                  `} //end of function, TurnOnOutput()`
                  +
                  `\n`
                  ;
/*Void Setup*/    const SetupFunction =
                  `void setup()`
                  +
                  `\n`
                  +
                  `{`
                  +
                  `\n \t`
                  +
                  `// Initialize serial communication`
                  +
                  `\n \t`
                  +
                  `lcd.init(); // initialize the lcd` 
                  +
                  `\n \t`
                  +
                  `lcd.backlight();`
                  +
                  `\n \t`
                  + 
                  `\n \t`
                  +
                  `//Button Initialization`
                  +
                  `\n \t`
                  +
                  `pinMode(InputUp, INPUT);`
                  + 
                  `\n \t`
                  +
                  `pinMode(InputDown, INPUT);`    
                  + 
                  `\n \t`
                  +
                  `pinMode(InputLeft, INPUT);`
                  + 
                  `\n \t`
                  +
                  `pinMode(InputRight, INPUT);` 
                  + 
                  `\n \t`
                  +
                  `pinMode(InputSelect, INPUT);`  
                  + 
                  `\n \t`
                  +
                  `selectPressed = true;`  // Initialize the select button latch
                  + 
                  `\n \t`
                  +
                  `Serial.begin(9600);`
                  +
                  `\n \t`
                  +
                  `readUserInput();`
                  +
                  `\n \t`
                  +
                  `TurnOnOutput(); //we want to start the microcontroller with the output on`
                  +
                  `\n`
                  +
                  `} //End of void setup`
                  +
                  `\n \n`
                  ;
                                    
                                    
/*Void Default Screen State*/const DefaultScreenState =
                  `\n \t`
                  +
                  `enum State`
                  +
                  `\n \t`
                  +
                  `{`
                  +
                  `\n \t \t`
                  +
                  `SCROLLING,`
                  +
                  `\n \t \t`
                  +
                  `SELECTING`
                  +
                    `\n \t`
                  +
                  `};`
                  +
                  `\n \t`
                  +
                  `State currentState = SCROLLING;`
                  +
                  `\n \t`
                  ;
                   
/*Void Loop*/     const LoopFunction =
                  `void loop()`
                  +
                  `\n`
                  +
                  `{`
                  +
                  `\n`
                  +
                  `\n \t`
                  +
                  `//Low voltage disconnection: If the battery voltage is lower than the cut off voltage, turn off the load when the override period expires`
                  +
                  `\n \t`
                  +
                  `static unsigned long StartTime = 0;`
                  +
                  `\n \t`
                  +
                  `static unsigned long EndTime = 0;`
                  +
                  `\n \t`
                  +
                  `static bool TimerHasStarted = false;`
                  +
                  `\n \t`
                  +
                  `if (MeasureVoltage() < ShutOffVoltage)`
                  +
                  `\n \t`
                  +
                  `{`
                  +
                  `\n \t \t`               
                  +
                  `if(TimerHasStarted == false)`
                  +
                  `\n \t \t`
                  +
                  `{`
                  +
                  `\n \t \t \t`
                  +
                  `StartTime = TimeSinceBoot();`
                  +
                  `\n \t \t \t`
                  +
                  `EndTime = SetTimerEnd()+DisconnectBufferTime;`
                  +
                  `\n \t \t \t`
                  +
                  `TimerHasStarted = true;`
                  +
                  `\n \t \t \t`
                  +
                  `Serial.print(DeviceName +"Timer started at: ");`
                  +
                  `\n \t \t \t`
                  +
                  `Serial.print(StartTime / 1000); // Convert milliseconds to seconds`
                  +
                  `\n \t \t \t`
                  +
                  `Serial.println(" seconds");`
                  +
                  `\n \t \t \t`
                  +
                  `Serial.print(DeviceName +"Timer will end at: ");`
                  +
                  `\n \t \t \t`
                  +
                  `Serial.print(EndTime / 1000); // Convert milliseconds to seconds`
                  +
                  `\n \t \t \t`
                  +
                  `Serial.println(" seconds");`
                  +
                  `\n \t \t \t`
                  +
                  `Serial.println("Countdown:");`
                  +
                  `\n \t \t`
                  +
                  `} // end of if TimerHasStarted == false statement`
                  +
                  `\n \t \t \t`
                  +
                  `unsigned long currentTime = TimeSinceBoot();`
                  +
                  `\n \t \t \t`
                  +
                  `if (currentTime < EndTime)`
                  +
                  `\n \t \t \t`
                  +
                  `{`
                  +
                  `\n \t \t \t \t`
                  +
                  `unsigned long remainingTime = EndTime - currentTime;`
                  +
                  `\n \t \t \t \t`
                  +
                  `Serial.print(remainingTime / 1000); // Convert milliseconds to seconds`
                  +
                  `\n \t \t \t \t`
                  +
                  `Serial.println(" seconds remaining");`
                  +
                  `\n \t \t \t \t`
                  +
                  `// Other tasks can run here while the timer is active`
                  +
                  `\n \t \t \t`
                  +
                  `} // end of if(currentTime < EndTime)`
                  +
                  `\n \t \t \t`
                  +
                  `else`
                  +
                  `\n \t \t \t`
                  +
                  `{`
                  +
                  `\n \t \t \t \t`
                  +
                  `Serial.println("Timer completed. Load can be turned off.");`
                  +
                  `\n \t \t \t \t`
                  +
                  `TimerHasStarted = false;`
                  +
                  `\n \t \t \t \t`
                  +
                  `TurnOffOutput();`
                  +
                  `\n \t \t \t`
                  +
                  `} // end of else statement`
                  +
                  `\n \t \t \t`
                   +
                  `} // end of if MeasureVoltage()<ShutOffVoltage`
                  +
                  `\n \t \t \t`
                  +
                  `//Reconnection: If the battery voltage has been recharged over the set reconnect voltage, turn the load back on`
                  +
                  `\n \t \t`
                  +
                  `if (MeasureVoltage()>TurnBackOnVoltage)`
                  +
                  `\n \t \t`
                  +
                  `{`
                  +
                  `\n \t \t \t`
                  +
                  `TurnOnOutput();`
                  +
                  `\n \t \t \t`
                  +  
                  `TimerHasStarted = false;`
                  +
                  `\n \t \t`
                  +
                  `} //end of if statement`
                  +
                  `\n \t \t`
                  +
                  `int EncoderSelectState = digitalRead(EncoderSW);`
                  +
                  `\n \t` 
                  +
                  `int SELECT_State = digitalRead(InputSelect);`
                  +
                  `\n \t `
                  +
                  `// Toggle the select latch only when the SELECT button is pressed`
                  +
                  `\n \t`
                  +
                  `if ((SELECT_State == HIGH || EncoderSelectState == HIGH) && currentState==SCROLLING)`
                  +
                  `\n \t`
                  +
                  `{`
                  +
                  `\n \t `
                  +
                  `selectPressed = !selectPressed;`
                  +
                  `\n \t` 
                  +
                  `delay(200); // NEEDED Delay so it doesn't think you are holding it down, or it will always allow scrolling`
                  +
                  `\n \t` 
                  +
                  `} // end of if (SELECT_State == HIGH)       Make sure delay doesn't mess up the override or delay off timer!`
                  +
                  `\n \t` 
                  +
                  `switch (currentState)`
                  +
                  `\n \t` 
                  +
                  `{`
                  +
                  `\n \t` 
                  +
                  `case SCROLLING:`
                  +
                  `\n \t` 
                  +
                  `if (!selectPressed)`
                  +
                  `\n \t` 
                  +
                  `{`
                  +
                  `\n \t` 
                  +
                  `// Only allow scrolling if select is not pressed`
                  +
                  `\n \t` 
                  +
                  `currentState = SELECTING;`
                  +
                  `\n \t` 
                  +
                  `} else {`
                  +
                  `\n \t` 
                  +
                  `// Transition to the SELECTING state`
                  +
                  `\n \t` 
                  +
                  `Scroll();`
                  +
                  `\n \t` 
                  +
                  `// Additional actions or setup for entering the SELECTING state`
                  +
                  `\n \t` 
                  +
                  `}`
                  +
                  `\n \t` 
                  +
                  `break;`
                  +
                  `\n \t` 
                  +
                  `case SELECTING:`
                  +
                  `\n \t` 
                  +
                  `// Perform actions when the select is pressed`
                  +
                  `\n \t` 
                  +
                  `Select();`
                  +
                  `\n \t` 
                  +
                  `// Transition back to SCROLLING state if select is released`
                  +
                  `\n \t` 
                  +
                  `if (!selectPressed)`
                  +
                  `\n \t` 
                  +
                  `{`
                  +
                  `\n \t` 
                  +
                  `currentState = SCROLLING;     //This is the problem, allows select function to work, yet scrolling takes precedence as well.`
                  +
                  `\n \t` 
                  +
                  `Serial.print(DeviceName +"Going Back to scrolling");      //Right and left buttons work, but shouldn't.`
                  +
                  `\n \t` 
                  +
                  `// Additional actions or setup for entering the SCROLLING state`
                  +
                  `\n \t` 
                  +
                  `}`
                  +
                  `\n \t` 
                  +
                  `break;`
                  +
                  `\n \t` 
                  +
                  `}`
                  +
                  `\n \t` 
                  +
                  `} //End of Void Loop`
                  ;//end of arduinoCode constant
            
        //select the control scheme to put into the Blob     
        
        if(ControlSelection == 1)
        {
            var ScrollFunction = ButtonScrollFunction;
            var SelectFunction = ButtonSelectFunction;
            var LibrariesSection = LibrariesSectionButtonArray;    
        }
        if(ControlSelection ==2)
        {
            var ScrollFunction = EncoderScrollFunction;
            var SelectFunction = EncoderSelectFunction;
            var LibrariesSection = LibrariesSectionEncoder;
        }
            
        // Create a Blob containing the Arduino code
        const blob = new Blob([CodeHead + LibrariesSection + LiquidCrystalDisplayVariablesSection + VoltageProbeSpecifications + GlobalVariables + TimerRelatedVariables + GetPinAssignments + EncoderSetup + LCDScreenCaseStatements + ScrollFunction + SelectFunction + ReadUserInputMemoryFunction + WriteUserInputMemoryFunction + TimeSinceBootFunction + StartTimerFunction + VoltageMeasurementFunction + TurnOffOutputFunction + TurnOnOutputFunction + SetupFunction + DefaultScreenState + LoopFunction], { type: 'text/plain' });

        // Create a download link
        const downloadLink = document.getElementById("downloadLink");
        downloadLink.href = URL.createObjectURL(blob);
        downloadLink.download = "arduino_code.ino"; // Set the filename

        downloadLink.style.display = "block";
                           
        }//end else
        }//end function generate code     
    </script>
    <br>
</body>
</html>