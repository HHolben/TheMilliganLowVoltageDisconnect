<!DOCTYPE html>

<!--Low voltage disconnect customer form
    Programmed by Henry Holben and Weston Street using some code generated by ChatGPT, https://chat.openai.com/


-->




<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LVD Code Generator</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <h1>Milligan Engineering Low Voltage Disconnect Software Generator</h1>
    <h2>By the Milligan Engineering Low Voltage Disconnect Crew</h2>
</head>
<img src="LVDCpreliminarylogoV2.png" alt="Picture of a buff battery in a life preserver." width="460" height="345">


<img src="LVDteamPhoto22Feb2024.jpg" alt="Picture of a professor and some dumb undergrands linking arms with eachother and with a junction box that looks way to big for what it is." width="460" height="345">

<link rel="icon" type="image/x-icon" href="/images/favicon.ico">

		<form>

        
        <!--Device Name-->
            <h3>Device Name</h3>
            <p>Personalize your LVD by giving it a name! This will be used in the filename of your arduino code and on the Status page of your user interface. It must be 11 characters or fewer.</p>

            <label for="DeviceName">Device Name:</label>
            <br>
            <input type="text" id="DeviceName" name="DeviceName" value="Theophilus">
            <br>
            <!--<input type="checkbox" id="EnableNameChange" name="EnableNameChange" value="true">Allow the user to change the name of their low voltage disconnect-->
            <br>
        
        <!--Nominal Voltage-->
            <h3>Nominal voltage</h3>
            <label for="NominalVoltage">Enter NominalVoltage Value:</label>
            <input type="number" id="NominalVoltage" name="NominalVoltage" value="12" required> volts
            <br>
            <span class="error" id="NominalVoltageError" style="color:red"></span><br><br>
            <br>
            <input type="checkbox" id="EnableNominalVoltageInterface" name="EnableNominalVoltageInterface" value="true" checked="checked"> <!-- selected by default-->Allow the user to change the nominal voltage <br>
            <br>
        
        <!--Shut off Voltage Form-->
            <h3>Shut Off voltage</h3>
            <label for="ShutOffVoltage">Enter ShutOffVoltage Value:</label> volts
            <input type="number" id="ShutOffVoltage" name="ShutOffVoltage" value="6" required> volts
            <span class="error" id="ShutOffVoltageError"></span><br><br><br>
            <input type="checkbox" id="EnableShutOffVoltageInterface" name="EnableShutOffVoltageInterface" value="ShutOffEnabled"  checked="checked"> <!-- selected by default-->Allow the user to change the turn-back-on voltage <br>
<br>
        <!-- Shut Off Voltage Timer-->
            <h3>Shut Off Voltage Timer:</h3>
            <p>This is a buffer period meant to prevent the LVDC from disconnecting prematurely on account of current spikes, troughs, or noise.</p>
            <input type="number" id="ShutOffVoltageTimer" name="ShutOffVoltageTimer" value="30"> seconds
            <br>
            <input type="checkbox" id="EnableShutOffVoltageTimerBoolean" name="EnableShutOffVoltageTimerBoolean" value="TRUE">
            <label for="EnableTimerOffsetBoolean">Check to enable changing of shut off voltage timer</label><br>
        
        
        <!--Turn Back on Voltage Form-->
            <h3>Turn-back on Voltage:</h3>
            <input type="number" id="TurnBackOnVoltage" name="TurnBackOnVoltage" value="10"> volts
            <br>
            <input type="checkbox" id="EnableTurnBackOnVoltageInterface" name="EnableTurnBackOnVoltageInterface" value="TurnBackOnEnabled" checked="checked"> <!-- selected by default-->
            <label for="TurnBackOnVoltage">Allow the user to change the turn-back-on voltage</label><br>
        

        <!-- Override-->
            <h3>Overide:</h3>
            <input type="number" id="OverrideDelay" name="OverrideDelay" value="20"> minutes
            <br>
            <input type="checkbox" id="override" name="override" value="TRUE" checked="checked"> <!-- selected by default-->
            <label for="override">Check to change overide delay time</label><br>
            <br>
            <br>
        
        <!-- TimerOffset-->
            <h3>Timer Offset:</h3>
            <input type="number" id="TimerOffset" name="TimerOffset" value="0"> seconds
            <br>
            <input type="checkbox" id="EnableTimerOffsetBoolean" name="EnableTimerOffsetBoolean" value="TRUE">
            <label for="EnableTimerOffsetBoolean">Check to enable changing of the timer offset</label><br>
        
        <!-- Language-->
            <h3>Language:</h3>
            Default Language:
            <br>
            <input type="radio" id="english" name="LanguageSetting" value="english" checked="checked"> <!-- selected by default-->
            <input type="radio" id="spanish" name="LanguageSetting" value="spanish">
            <label for="spanish">Spanish</label><br>
            <br>
            <br>
            <input type="checkbox" id="EnableLanguageInterface" name="EnableLanguageInterface" value="LanguageChoiceEnabled">
            <label for="EnableLanguageInterface">Check to enable language selection</label><br>
            <br>
        
        <!--Memory Addresses-->
        <h3>Device Memory Addresses:</h3>
        <p>You can use this section to select which memory locations are to be used for each variable. If an address has worn out on your device you can use this section to choose an alternative address. Valid values are 0 to 511, but no two variables may be assigned to the same address. Listed addresses must be at least 5 addresses apart to prevent overlapping when memory is used.</p>
        <input type="number" id="LVDnameAddress" name="LVDnameAddress" min="0" max="511" value="1" required>
        <label for="LVDnameAddress">Specify address for the device name</label> 
        <br>
        <!---->
        <input type="number" id="NominalVoltageAddress" name="NominalVoltageAddress" min="0" max="511" value="11" required>
        <label for="NominalVoltageAddress">Specify address for the nominal voltage.</label> 
        <br>
        <input type="number" id="ShutOffVoltageAddress" name="ShutOffVoltageAddress" min="0" max="511" value="21" required>
        <label for="ShutOffVoltageAddress">Specify address for the shut-off voltage</label> 
        <br>
        <input type="number" id="DisconnectTimeAddress" name="DisconnectTimeAddress" min="0" max="511" value="31" required>
        <label for="DisconnectTimeAddress">Specify address for the disconnect timer's time</label> 
        <br>
        <input type="number" id="TurnOnVoltageAddress" name="TurnOnVoltageAddress" min="0" max="511" value="41" required>
        <label for="TurnOnVoltageAddress">Specify address for the turn-back-on voltage</label> 
        <br>
        <input type="number" id="OverrideTimeAddress" name="OverrideTimeAddress" min="0" max="511" value="51" required>
        <label for="OverrideTimeAddress">Specify address for the turn-back-on voltage</label>
        <br>
        <input type="number" id="TimerOffsetAddress" name="TimerOffsetAddress" min="0" max="511" value="61" required>
        <label for="TimerOffsetAddress">Specify address for the timer's offset time</label>
        <br>
        <input type="number" id="LanguageAddress" name="LanguageAddress" min="0" max="511" value="71" required>
        <label for="LanguageAddress">Specify address for the timer's language setting</label>
        <br>
        


        <!-- Board-->
            <h3>Board:</h3>
            Select a device:
            <br>
            <input type="radio" id="ArduinoNano" name="DeviceSetting" value="ArduinoNano">
            <label for="ArduinoNano">Arduino Nano</label> 
            <br>
            <input type="radio" id="ArduinoNanoESP32" name="DeviceSetting" value="ArduinoNanoESP32">
            <label for="ArduinoNanoEsp32">Arduino Nano ESP 32</label>
            <br>
            <input type="radio" id="ArduinoUno" name="DeviceSetting" value="ArduinoUno" checked="checked"> <!-- selected by default-->
            <label for="ArduinoUno">Arduino Uno</label> 
            <br>
            <input type="radio" id="ArduinoMega" name="DeviceSetting" value="ArduinoMega">
            <label for="ArduinoMega">Arduino Mega</label><br>

        <!-- Controller type-->
            <h3>Controller type:</h3>
            Select a controller type:
            <br>
            <input type="radio" id="ButtonArray" name="ControlTypeSetting" value="ButtonArray" checked="checked"> <!-- selected by default-->
            <label for="ButtonArray">Array of 5  push buttons</label> 
            <br>
            <input type="radio" id="Encoder" name="ControlTypeSetting" value="Encoder">
            <label for="Encoder">Rotary Encoder</label><br>
            <br>

        <!-- Output type-->
            <h3>Output Type:</h3>
            Select what hardware is to be to be used to power on the load:
            <br>
            <input type="radio" id="RelayOutput" name="OutputType" value="RelayOutput" checked="checked"> <!-- default-->
            <label for="RelayOutput">Mechanical Relay</label> 
            <br>
            <input type="radio" id="InverterControl" name="OutputType" value="InverterControl">
            <label for="InverterControl">Inverter Data Cable</label><br>
            <br>

        <!--Buttons to begin the generation of the arduino file:-->
            <button type="button" onclick="generateCode()">Generate Arduino Code</button>
            <br>            

        
    </form>
    
    <br>
    
    <a id="downloadLink" style="display: none" download="arduino_code.ino">Download Arduino Code</a>
    
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>

<!--Rhe javascript files that are stored in this folderun t-->
<script src = "PinData.js" defer></script>
<script src = "ExtractFormVariables.js" defer></script>
<script src = "ConvertMenuItemsToString.js" defer></script>

<script src = "Explanations.js" defer></script>

<script src = "CodeHead.js" defer></script>
<script src = "LibrariesSection.js" defer></script>
<script src = "InitialCppVariables.js" defer></script>
<script src = "PagesLCD.js" defer></script>
<script src = "ScrollFunctions.js" defer></script>
<script src = "SelectFunctions.js" defer></script>
<script src = "MemoryFunctions.js" defer></script>
<script src = "MeasurementFunction.js" defer></script>

<script src = "TimerFunctions.js" defer></script>
<script src = "OutputTogglingFunctions.js" defer></script>
<script src = "VoltageCheckRoutines.js" defer></script>
<script src = "LatchesSection.js" defer></script>
<script src = "SetupFunction.js" defer></script>
<script src = "VoidLoop.js" defer></script>



    <script type="text/javascript">  
    
    

    
        //Generate the arduino Code
        function generateCode()
        {
            //end function generate code  


  // Fetch input values
  const NominalVoltage = parseInt(document.getElementById('NominalVoltage').value);
    const ShutOffVoltage = parseFloat(document.getElementById('ShutOffVoltage').value);
    const TurnBackOnVoltage = parseFloat(document.getElementById('TurnBackOnVoltage').value);
    const OverrideDelay = parseFloat(document.getElementById('OverrideDelay').value);
    const NominalVoltageAddress =parseFloat(document.getElementById('NominalVoltageAddress').value);
    const ShutOffVoltageAddress =parseFloat(document.getElementById('ShutOffVoltageAddress').value);
    const DisconnectTimeAddress =parseFloat(document.getElementById('DisconnectTimeAddress').value);
    const TurnOnVoltageAddress =parseFloat(document.getElementById('TurnOnVoltageAddress').value);
    const OverrideTimeAddress =parseFloat(document.getElementById('OverrideTimeAddress').value);
    const TimerOffsetAddress =parseFloat(document.getElementById('TimerOffsetAddress').value);
    const LanguageAddress =parseFloat(document.getElementById('LanguageAddress').value);


    

    // Check that inputs are valid       
    const NominalVoltageError = document.getElementById('NominalVoltageError');
    const ShutOffVoltageError = document.getElementById('ShutOffVoltageError');
    NominalVoltageError.textContent = '';
    ShutOffVoltageError.textContent = '';

    if (isNaN(NominalVoltage) || NominalVoltage <= 0) {
        alert("Please enter a positive integer multiple of 12 for Nominal Voltage.");
    } else if (NominalVoltage % 12 !== 0) {
        NominalVoltageError.textContent = 'Please enter a positive integer multiple of 12 for Nominal Voltage.';
        alert("Nominal Voltage must be a positive integer multiple of 12.");
    } else if (isNaN(ShutOffVoltage) || ShutOffVoltage <= 0) {
        alert("Please enter a positive number for Shut Off Voltage (decimal values allowed).");
    } else if (isNaN(TurnBackOnVoltage) || TurnBackOnVoltage <= 0) {
        alert("Please enter a positive number for Turn Back On Voltage (decimal values allowed).");
    } else if (isNaN(OverrideDelay) || OverrideDelay <= 0) {
        alert("Please enter a positive number for override delay (decimal values allowed).");
    } else {
        // Integer validation
        const inputs = [NominalVoltageAddress, ShutOffVoltageAddress, DisconnectTimeAddress, TurnOnVoltageAddress, OverrideTimeAddress, TimerOffsetAddress, LanguageAddress];


        



        const tolerance = 5;
        let isValid = true;

        for (let i = 0; i < inputs.length; i++) {
            for (let j = i + 1; j < inputs.length; j++) {
                if (Math.abs(inputs[i] - inputs[j]) < tolerance) {
                    alert(inputs[i] + " should be at least 5 apart from all other EEPROM addresses.");
                    isValid = false;
                    break;
                }
            }
            if (!isValid) {
                break;
            }
        }

        // If all inputs are valid, proceed with code generation
        if (isValid) {
                    //select the control scheme to put into the Blob     
                    if(ControlSelection == 1)
                    {
                        var ScrollFunction = ButtonScrollFunction;
                        var SelectFunction = ButtonSelectFunction;
                        var LibrariesSection = LibrariesSectionButtonArray; 
                        var SetUpFunction = SetupFunctionButtons;
                        var ControlSchemeGlobalVariables = ButtonRelatedGlobalVariables;
                    }
                    else if(ControlSelection ==2)
                    {
                        var ScrollFunction = EncoderScrollFunction;
                        var SelectFunction = EncoderSelectFunction;
                        var LibrariesSection = LibrariesSectionEncoder;
                        var SetUpFunction = SetupFunctionEncoder;
                        var ControlSchemeGlobalVariables = EncoderRelatedGlobalVariables;
                    }




                 DefaultMenuPageScreenStateEnumItems =
                 DefaultMenuPageScreenStateEnumItems
                 +
                 `\n \t \t`
                 +
                 `${EnumAdjustables[i]}`
                 ;

                    // Create a Blob containing the Arduino code
                    const blob = new Blob(
                    [
                        CodeHead 
                        + 
                        LibrariesSection 
                        + 
                        MenuItems 
                        +
                        GetPinAssignments 
                        +
                        GlobalVariables 
                        + 
                        TimerRelatedVariables 
                        + 
                        VoltageProbeSpecifications
                        +
                        LiquidCrystalDisplayVariablesSection 
                        + 
                        ControlSchemeGlobalVariables                    
                        +
                        VoltageMeasurementFunction 
                        + 
                        StatusPage 
                        + 
                        MenuPage 
                        + 
                        AdjustNominalVoltagePage 
                        + 
                        AdjustCutOffVoltagePage
                        +
                        AdjustReconnectVoltagePage
                        +
                        AdjustOverrideTimePage
                        /*
                        +
                        ChangeLanguagePage*/
                        +
                        ScrollFunction 
                        + 
                        SelectFunction 
                        +
                        TimeSinceBootFunction 
                        + 
                        DisconnectBufferTimerEnd 
                        + 
                        OverrideTimerEnd 
                        +
                        ReconnectTimerEnd
                        +
                        TurnOffOutputFunction 
                        + 
                        TurnOnOutputFunction 
                        + 
                        DefaultMenuPageScreenState
                        +
                        VoidOverride
                        +
                        VoidLVDMode
                        +
                        SwitchPage
                        +
                        SetUpFunction                      
                        +
                        LoopFunctionStart
                        +
                        LoopFunctionPages
                    ], { type: 'text/plain' });

                    // Create a download link

                    const FileName = DeviceName + '_LVD_Program.ino'; 

                    const downloadLink = document.getElementById("downloadLink");
                    downloadLink.href = URL.createObjectURL(blob);
                    downloadLink.download = FileName; // Set the filename

                    downloadLink.style.display = "block";

        }//end if
                }//end else
            
        }//end function generate code     
    </script>



  </body>
</html>